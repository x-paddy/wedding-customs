<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Wedding Traditions - Content Dashboard
  </title>
  <link href="../css/dashboard-unified.css" rel="stylesheet"/>
  <style>
   /* Page-specific styles for Content Dashboard */
        
        /* Tab Container */
        .tab-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .tab {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            position: relative;
            color: #666;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .tab.active {
            color: #007bff;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #007bff;
        }
        
        .tab-metric {
            background: #e9ecef;
            color: #495057;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 8px;
        }
        
        .tab.active .tab-metric {
            background: #007bff;
            color: white;
        }
        
        /* Performance Metrics */
        .performance-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .performance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .performance-title {
            font-size: 1.2em;
            font-weight: 600;
        }
        
        .performance-avg {
            font-size: 1.5em;
            font-weight: 700;
            color: #28a745;
        }
        
        .metric-bars {
            display: grid;
            gap: 10px;
        }
        
        .metric-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .metric-label {
            width: 120px;
            font-size: 0.9em;
            color: #666;
        }
        
        .metric-progress {
            flex: 1;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .metric-fill {
            height: 100%;
            background: #28a745;
            transition: width 0.3s;
        }
        
        .metric-value {
            width: 40px;
            text-align: right;
            font-weight: 600;
        }
        
        /* Data table specific styles */
        .filter-controls {
            margin-bottom: 20px;
        }
        
        .filter-controls input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
        }
        
        /* Status colors */
        .status-good { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-poor { color: #dc3545; }
  </style>
 </head>
 <body>
  <div class="dashboard-container">
   <h1>
    Content Dashboard
   </h1>
   <nav class="dashboard-nav">
    <div class="nav-left">
     <div class="toggle-container">
      <a class="toggle-btn" data-page="index" href="index.html">
       Content
      </a>
      <a class="toggle-btn" data-page="api" href="api.html">
       Lighthouse API
      </a>
      <a class="toggle-btn" data-page="inlinks" href="inlinks.html">
       Inlinks
      </a>
     </div>
    </div>
    <div class="nav-right">
     <button class="doc-toggle-btn" onclick="viewDocument('workflow')" title="View Pipeline Workflow">
      ðŸ“‹ Workflow
     </button>
    </div>
   </nav>
   <div class="container">
    <div class="timestamp">
     Last Updated:
     <span id="lastUpdated">
      Loading...
     </span>
    </div>
    <!-- Stats Grid -->
    <div class="stats-grid" id="summaryStats">
     <div class="stat-card">
      <h3>
       Total Articles
      </h3>
      <div class="stat-number" id="totalArticles">
       -
      </div>
     </div>
     <div class="stat-card">
      <h3>
       Countries
      </h3>
      <div class="stat-number" id="totalCountries">
       -
      </div>
     </div>
     <div class="stat-card">
      <h3>
       Images
      </h3>
      <div class="stat-number" id="totalImages">
       -
      </div>
     </div>
     <div class="stat-card">
      <h3>
       Audio Files
      </h3>
      <div class="stat-number" id="totalAudio">
       -
      </div>
     </div>
     <div class="stat-card">
      <h3>
       Total Words
      </h3>
      <div class="stat-number" id="totalWords">
       -
      </div>
     </div>
     <div class="stat-card">
      <h3>
       Coverage
      </h3>
      <div class="stat-number" id="coverage">
       -
      </div>
     </div>
    </div>
    <!-- Tab Container -->
    <div class="tab-container">
     <div class="tabs">
      <button class="tab active" onclick="showSummaryTab('content')">
       Content
       <span class="tab-metric" id="articlesCount">
        -
       </span>
      </button>
      <button class="tab" onclick="showSummaryTab('media')">
       Media
       <span class="tab-metric" id="imagesCount">
        -
       </span>
      </button>
      <button class="tab" onclick="showSummaryTab('performance')">
       Performance
       <span class="tab-metric" id="avgScore">
        -
       </span>
      </button>
      <button class="tab" onclick="showSummaryTab('technical')">
       Technical
       <span class="tab-metric" id="scriptsCount">
        -
       </span>
      </button>
     </div>
     <div id="tabContent">
      <!-- Content will be dynamically loaded here -->
     </div>
    </div>
    <!-- Main Data Table Section -->
    <div class="section">
     <h2>
      Country Articles
     </h2>
     <div class="filter-controls">
      <input id="searchInput" onkeyup="filterTable()" placeholder="Search countries..." type="text"/>
     </div>
     <div id="dataTableContainer">
      <div class="table-container">
       <table id="countriesTable">
        <thead>
         <tr>
          <th>
           Country
          </th>
          <th>
           Words
          </th>
          <th>
           Images
          </th>
          <th>
           Audio
          </th>
          <th>
           Sections
          </th>
          <th>
           FAQs
          </th>
          <th>
           Performance
          </th>
          <th>
           SEO
          </th>
         </tr>
        </thead>
        <tbody id="countriesTableBody">
         <tr>
          <td class="text-center" colspan="8">
           Loading data...
          </td>
         </tr>
        </tbody>
       </table>
      </div>
     </div>
    </div>
   </div>
  </div>
  <!-- Workflow Modal -->
  <div class="modal" id="workflowModal">
   <div class="modal-content">
    <div class="modal-header">
     <h2>
      Pipeline Workflow Status
     </h2>
     <button class="close" onclick="closeModal()">
      Ã—
     </button>
    </div>
    <div id="workflowContent">
     <p class="text-center">
      Loading workflow data...
     </p>
    </div>
   </div>
  </div>
  <script>
   // Set active class based on current page
        document.addEventListener('DOMContentLoaded', function() {
            const currentPage = window.location.pathname.split('/').pop().replace('.html', '') || 'index';
            const toggleButtons = document.querySelectorAll('.toggle-btn');
            
            toggleButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-page') === currentPage) {
                    btn.classList.add('active');
                }
            });
            
            // Load dashboard data
            loadDashboardData();
        });
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch('data/dashboard-stats.json');
                const data = await response.json();
                
                // Update summary stats
                document.getElementById('lastUpdated').textContent = new Date(data.last_updated).toLocaleString();
                document.getElementById('totalArticles').textContent = data.overview.total_articles;
                document.getElementById('totalCountries').textContent = data.overview.total_countries;
                document.getElementById('totalImages').textContent = formatNumber(data.overview.total_images);
                document.getElementById('totalAudio').textContent = formatNumber(data.overview.total_pronunciations);
                document.getElementById('totalWords').textContent = formatNumber(data.overview.total_words);
                document.getElementById('coverage').textContent = data.overview.coverage_percentage + '%';
                
                // Update tab metrics
                document.getElementById('articlesCount').textContent = data.content.articles.total;
                document.getElementById('imagesCount').textContent = formatNumber(data.content.media.images.total);
                document.getElementById('avgScore').textContent = Math.round(data.performance.lighthouse.average_performance);
                document.getElementById('scriptsCount').textContent = data.technical.build_system.total_scripts;
                
                // Load initial tab content
                showSummaryTab('content');
                
                // Load detailed country data
                loadCountryData();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        
        // Format numbers
        function formatNumber(num) {
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        // Tab switching
        function showSummaryTab(tabName) {
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Load tab content
            const contentDiv = document.getElementById('tabContent');
            contentDiv.innerHTML = '<p class="text-center">Loading...</p>';
            
            // Load content based on tab
            fetch('data/dashboard-stats.json')
                .then(response => response.json())
                .then(data => {
                    let content = '';
                    switch(tabName) {
                        case 'content':
                            content = `
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <h3>Articles</h3>
                                        <div class="stat-number">${data.content.articles.total}</div>
                                        <div class="stat-label">Avg ${data.content.articles.average_words} words</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>Sections per Article</h3>
                                        <div class="stat-number">${data.content.articles.average_sections}</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>Total FAQs</h3>
                                        <div class="stat-number">${data.content.articles.total_faqs}</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>FAQ Coverage</h3>
                                        <div class="stat-number">${data.health.content_completeness.faq_coverage}</div>
                                    </div>
                                </div>
                            `;
                            break;
                        case 'media':
                            content = `
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <h3>Total Images</h3>
                                        <div class="stat-number">${formatNumber(data.content.media.images.total)}</div>
                                        <div class="stat-label">${data.content.media.images.total_size_mb} MB</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>Image Formats</h3>
                                        <div class="stat-label">AVIF, WebP, JPG</div>
                                        <div class="stat-number">${formatNumber(data.content.media.images.webp_available)} WebP</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>Audio Files</h3>
                                        <div class="stat-number">${formatNumber(data.content.media.audio.total_pronunciations)}</div>
                                        <div class="stat-label">MP3 pronunciations</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>Audio Coverage</h3>
                                        <div class="stat-number">${data.content.media.audio.coverage}</div>
                                    </div>
                                </div>
                            `;
                            break;
                        case 'performance':
                            content = `
                                <div class="performance-card">
                                    <div class="performance-header">
                                        <div class="performance-title">Lighthouse Scores</div>
                                        <div class="performance-avg">${Math.round(data.performance.lighthouse.average_performance)}</div>
                                    </div>
                                    <div class="metric-bars">
                                        <div class="metric-bar">
                                            <div class="metric-label">Performance</div>
                                            <div class="metric-progress">
                                                <div class="metric-fill" style="width: ${data.performance.lighthouse.average_performance}%"></div>
                                            </div>
                                            <div class="metric-value">${Math.round(data.performance.lighthouse.average_performance)}</div>
                                        </div>
                                        <div class="metric-bar">
                                            <div class="metric-label">Accessibility</div>
                                            <div class="metric-progress">
                                                <div class="metric-fill" style="width: ${data.performance.lighthouse.average_accessibility}%"></div>
                                            </div>
                                            <div class="metric-value">${Math.round(data.performance.lighthouse.average_accessibility)}</div>
                                        </div>
                                        <div class="metric-bar">
                                            <div class="metric-label">Best Practices</div>
                                            <div class="metric-progress">
                                                <div class="metric-fill" style="width: ${data.performance.lighthouse.average_best_practices}%"></div>
                                            </div>
                                            <div class="metric-value">${Math.round(data.performance.lighthouse.average_best_practices)}</div>
                                        </div>
                                        <div class="metric-bar">
                                            <div class="metric-label">SEO</div>
                                            <div class="metric-progress">
                                                <div class="metric-fill" style="width: ${data.performance.lighthouse.average_seo}%"></div>
                                            </div>
                                            <div class="metric-value">${Math.round(data.performance.lighthouse.average_seo)}</div>
                                        </div>
                                    </div>
                                </div>
                                <h3 style="margin-top: 20px;">Page Load Times</h3>
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <h3>3G</h3>
                                        <div class="stat-number">${data.technical.optimization.load_times['3g']}</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>4G</h3>
                                        <div class="stat-number">${data.technical.optimization.load_times['4g']}</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>WiFi</h3>
                                        <div class="stat-number">${data.technical.optimization.load_times.wifi}</div>
                                    </div>
                                </div>
                            `;
                            break;
                        case 'technical':
                            content = `
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <h3>Build Scripts</h3>
                                        <div class="stat-number">${data.technical.build_system.build_scripts}</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>Data Scripts</h3>
                                        <div class="stat-number">${data.technical.build_system.data_scripts}</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>Test Scripts</h3>
                                        <div class="stat-number">${data.technical.build_system.test_scripts}</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>Avg Build Time</h3>
                                        <div class="stat-number">${data.technical.build_system.average_build_time}s</div>
                                        <div class="stat-label">per country</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>Total Build Time</h3>
                                        <div class="stat-number">${data.technical.build_system.total_build_time_minutes} min</div>
                                    </div>
                                    <div class="stat-card">
                                        <h3>Compression</h3>
                                        <div class="stat-number">${Math.round(data.technical.optimization.gzip_compression * 100)}%</div>
                                        <div class="stat-label">GZIP savings</div>
                                    </div>
                                </div>
                            `;
                            break;
                    }
                    contentDiv.innerHTML = content;
                })
                .catch(error => {
                    contentDiv.innerHTML = '<div class="alert alert-warning">Error loading tab content</div>';
                });
        }
        
        // Workflow modal functions
        async function viewDocument(docType) {
            if (docType === 'workflow') {
                document.getElementById('workflowModal').style.display = 'block';
                await loadWorkflowData();
            }
        }
        
        function closeModal() {
            document.getElementById('workflowModal').style.display = 'none';
        }
        
        async function loadWorkflowData() {
            const contentDiv = document.getElementById('workflowContent');
            try {
                const response = await fetch('data/workflow-stats.json');
                const data = await response.json();
                contentDiv.innerHTML = formatWorkflowContent(data);
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <strong>Unable to load workflow data.</strong><br>
                        ${error.message}
                    </div>`;
            }
        }
        
        function formatWorkflowContent(data) {
            return `
                <div class="workflow-summary">
                    <h3>Pipeline Status: ${data.pipeline_status.overall_status}</h3>
                    <p>Last run: ${new Date(data.pipeline_status.last_run).toLocaleString()}</p>
                    <p>Success rate: ${data.pipeline_status.success_rate}%</p>
                </div>`;
        }
        
        // Load country data
        async function loadCountryData() {
            try {
                const response = await fetch('data/content-details.json');
                const data = await response.json();
                const tbody = document.getElementById('countriesTableBody');
                
                if (data && Object.keys(data).length > 0) {
                    const rows = [];
                    
                    // Process each country
                    Object.entries(data).forEach(([country, countryData]) => {
                        if (countryData.articles && countryData.articles.length > 0) {
                            // Sum up all articles for the country
                            const totals = countryData.articles.reduce((acc, article) => {
                                acc.words += article.word_count || 0;
                                acc.images += article.image_count || 0;
                                acc.pronunciations += article.pronunciation_count || 0;
                                acc.sections += article.section_count || 0;
                                acc.faqs += article.faq_count || 0;
                                acc.articles++;
                                return acc;
                            }, { words: 0, images: 0, pronunciations: 0, sections: 0, faqs: 0, articles: 0 });
                            
                            // Find the English article for the link
                            const englishArticle = countryData.articles.find(a => a.language === 'en') || countryData.articles[0];
                            const slug = englishArticle.slug || englishArticle.filename.replace('.html', '');
                            
                            rows.push({
                                name: country,
                                slug: slug,
                                words: totals.words,
                                images: totals.images,
                                pronunciations: totals.pronunciations,
                                sections: Math.round(totals.sections / totals.articles),
                                faqs: Math.round(totals.faqs / totals.articles)
                            });
                        }
                    });
                    
                    // Sort by country name
                    rows.sort((a, b) => a.name.localeCompare(b.name));
                    
                    // Render the table
                    tbody.innerHTML = rows.map(country => `
                        <tr>
                            <td><a href="/wedding-customs/${country.slug}/" target="_blank">${country.name}</a></td>
                            <td>${formatNumber(country.words)}</td>
                            <td>${country.images}</td>
                            <td>${country.pronunciations}</td>
                            <td>${country.sections}</td>
                            <td>${country.faqs}</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center">No data available</td></tr>';
                }
            } catch (error) {
                console.error('Error loading country data:', error);
                document.getElementById('countriesTableBody').innerHTML = 
                    '<tr><td colspan="8" class="text-center alert alert-warning">Error loading country data</td></tr>';
            }
        }
        
        // Get score class
        function getScoreClass(score) {
            if (score >= 90) return 'status-good';
            if (score >= 50) return 'status-warning';
            return 'status-poor';
        }
        
        // Table filtering
        function filterTable() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toLowerCase();
            const table = document.getElementById('countriesTable');
            if (table) {
                const rows = table.getElementsByTagName('tr');
                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].getElementsByTagName('td');
                    let found = false;
                    for (let j = 0; j < cells.length; j++) {
                        if (cells[j].textContent.toLowerCase().includes(filter)) {
                            found = true;
                            break;
                        }
                    }
                    rows[i].style.display = found ? '' : 'none';
                }
            }
        }
  </script>
  <style>
   /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            width: 90%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #333;
        }
        
        .close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #000;
        }
        
        #workflowContent {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .workflow-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
  </style>
 </body>
</html>
