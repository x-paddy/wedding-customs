<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Wedding Traditions - Content Dashboard
  </title>
  <link href="../css/dashboard-unified.css" rel="stylesheet"/>
  <style>
   /* Page-specific styles for Content Dashboard */
        
        .stat-card .value {
            font-size: 2em;
            font-weight: 700;
            color: #0066cc;
        }
        
        /* Data Table */
        .table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: auto;
            max-height: 80vh;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #2c3e50;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #1a252f;
            cursor: pointer;
            user-select: none;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th:hover {
            background: #34495e;
        }
        
        th.sort-asc::after {
            content: ' ↑';
            position: absolute;
            right: 8px;
        }
        
        th.sort-desc::after {
            content: ' ↓';
            position: absolute;
            right: 8px;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        /* Links */
        a {
            color: #0066cc;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
        }
        
        /* Timestamp */
        .data-timestamp {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.9em;
        }
        
        /* Entity View Button */
        .entity-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .entity-btn:hover {
            background: #0056b3;
        }
        
        .entity-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* Entity Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 50px auto;
            padding: 0;
            border: 1px solid #888;
            width: 90%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
            color: #333;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }
        
        .close:hover,
        .close:focus {
            color: #000;
        }
        
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .entity-section {
            margin-bottom: 25px;
        }
        
        .entity-section h3 {
            font-size: 1.2em;
            color: #007bff;
            margin-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 5px;
        }
        
        .entity-list {
            list-style: none;
            padding: 0;
        }
        
        .entity-list li {
            padding: 8px 12px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #007bff;
        }
        
        .entity-count {
            color: #666;
            font-size: 0.9em;
        }
        
        .entities-loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        
        .workflow-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
            white-space: nowrap;
        }
        
        .workflow-btn:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4);
        }
        
        .agent-buttons {
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .agent-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .agent-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(108, 117, 125, 0.3);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 0.9em;
            }
            
            th, td {
                padding: 8px;
            }
            
            .toggle-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .dashboard-nav {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-left {
                width: 100%;
                justify-content: space-between;
            }
            
            .nav-right {
                flex-direction: column;
                width: 100%;
                gap: 10px;
            }
            
            .pipeline-buttons, .agent-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .pipeline-label, .agents-label {
                display: block;
                width: 100%;
                text-align: center;
                margin-bottom: 5px;
            }
            
            .agent-btn, .workflow-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }
  </style>
  <!-- Modern Dashboard Styles -->
  <style>
   /* Modern Tab Container */
        .tab-container {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 40px;
            margin-top: 20px;
        }

        .tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #e8ecf1;
        }

        .tab {
            flex: 1;
            padding: 20px;
            background: white;
            border: none;
            border-bottom: 3px solid transparent;
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            text-align: center;
        }

        .tab-metric {
            display: block;
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
            margin-top: 5px;
        }

        .tab:hover {
            background: #f8f9fb;
        }

        .tab.active {
            background: linear-gradient(180deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            border-bottom-color: #1d4ed8;
        }

        .tab.active .tab-metric {
            color: white;
        }

        .summary-content {
            display: none;
            padding: 40px;
            background: white;
        }

        .summary-content.active {
            display: block;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .metric-card {
            padding: 30px;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .metric-card:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .metric-green {
            background: linear-gradient(135deg, #fafffe 0%, #f5fffa 100%);
            color: #14532d;
        }

        .metric-green .metric-value {
            color: #16a34a !important;
        }

        .metric-orange {
            background: linear-gradient(135deg, #fffcf8 0%, #fff9f2 100%);
            color: #7c2d12;
        }

        .metric-orange .metric-value {
            color: #ea580c !important;
        }

        .metric-red {
            background: linear-gradient(135deg, #fffafa 0%, #fff8f8 100%);
            color: #7f1d1d;
        }

        .metric-red .metric-value {
            color: #dc2626 !important;
        }

        .metric-label {
            color: currentColor !important;
            opacity: 0.7;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .metric-value {
            color: currentColor !important;
            font-size: 36px;
            font-weight: 700;
            line-height: 1;
        }

        .metric-subtitle {
            color: currentColor !important;
            opacity: 0.8;
            font-size: 13px;
            margin-top: 6px;
        }

        .metric-trend {
            display: inline-block;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.5);
            color: currentColor;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr !important;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 1 50%;
            }
        }
    
    
        .details-container {
            margin-top: 40px;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .details-container h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #1a1a1a;
        }
        
        .details-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .details-table th {
            background: #f8f9fb;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 2px solid #e8ecf1;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .details-table td {
            padding: 12px;
            border-bottom: 1px solid #e8ecf1;
        }
        
        .details-table tr:hover {
            background: #f8f9fb;
        }
        
        .text-center {
            text-align: center;
        }
        
        .score-good {
            color: #16a34a;
            font-weight: 600;
        }
        
        .score-moderate {
            color: #ea580c;
            font-weight: 600;
        }
        
        .score-poor {
            color: #dc2626;
            font-weight: 600;
        }
        
        .health-good {
            color: #16a34a;
        }
        
        .health-moderate {
            color: #ea580c;
        }
        
        .health-poor {
            color: #dc2626;
        }
        
        @media (max-width: 768px) {
            .details-container {
                padding: 15px;
                overflow-x: auto;
            }
            
            .details-table {
                min-width: 800px;
            }
        }
  </style>
 </head>
 <body>
  <div class="dashboard-container">
   <h1>
    Content Dashboard
   </h1>
   <nav class="dashboard-nav">
    <div class="nav-left">
     <div class="toggle-container">
      <a class="toggle-btn" data-page="index" href="index.html">
       Content
      </a>
      <a class="toggle-btn" data-page="api" href="api.html">
       Lighthouse API
      </a>
      <a class="toggle-btn" data-page="inlinks" href="inlinks.html">
       Inlinks
      </a>
     </div>
    </div>
    <div class="nav-right">
     <button class="doc-toggle-btn" onclick="viewDocument('workflow')" title="View Pipeline Workflow">
      📋 Workflow
     </button>
    </div>
   </nav>
   <!-- Modern Tab Summary Section -->
   <div class="tab-container">
    <div class="tabs">
     <button class="tab active" onclick="showSummaryTab('content')">
      Content
      <span class="tab-metric" id="articlesCount">
       258
      </span>
     </button>
     <button class="tab" onclick="showSummaryTab('media')">
      Media
      <span class="tab-metric" id="imagesCount">
       10.5K
      </span>
     </button>
     <button class="tab" onclick="showSummaryTab('audio')">
      Audio
      <span class="tab-metric" id="audioCount">
       6.7K
      </span>
     </button>
     <button class="tab" onclick="showSummaryTab('coverage')">
      Coverage
      <span class="tab-metric" id="coveragePercent">
       100%
      </span>
     </button>
     <button class="tab" onclick="showSummaryTab('engagement')">
      Engagement
      <span class="tab-metric" id="engagementScore">
       94
      </span>
     </button>
    </div>
    <div class="summary-content active" id="content-content">
     <div class="metrics-grid">
      <div class="metric-card metric-green">
       <div class="metric-label">
        Total Articles
       </div>
       <div class="metric-value">
        258
       </div>
       <div class="metric-subtitle">
        244 countries + 14 regions
       </div>
       <div class="metric-trend">
        ✓ Complete coverage
       </div>
      </div>
      <div class="metric-card metric-green">
       <div class="metric-label">
        Total Words
       </div>
       <div class="metric-value">
        1.75M
       </div>
       <div class="metric-subtitle">
        Average 6,778 words/article
       </div>
       <div class="metric-trend">
        ↑ Rich content
       </div>
      </div>
      <div class="metric-card metric-green">
       <div class="metric-label">
        FAQ Sections
       </div>
       <div class="metric-value">
        1,820
       </div>
       <div class="metric-subtitle">
        7+ per article average
       </div>
       <div class="metric-trend">
        ↑ Comprehensive
       </div>
      </div>
     </div>
    </div>
    <div class="summary-content" id="media-content">
     <div class="metrics-grid">
      <div class="metric-card metric-green">
       <div class="metric-label">
        Total Images
       </div>
       <div class="metric-value">
        10,486
       </div>
       <div class="metric-subtitle">
        DALL-E 3 generated + stock
       </div>
       <div class="metric-trend">
        ↑ 40.6 per article
       </div>
      </div>
      <div class="metric-card metric-green">
       <div class="metric-label">
        Hero Images
       </div>
       <div class="metric-value">
        293
       </div>
       <div class="metric-subtitle">
        Custom DALL-E 3 creations
       </div>
       <div class="metric-trend">
        ✓ All optimized
       </div>
      </div>
      <div class="metric-card metric-green">
       <div class="metric-label">
        Image Formats
       </div>
       <div class="metric-value">
        3 Types
       </div>
       <div class="metric-subtitle">
        AVIF, WebP, and JPG
       </div>
       <div class="metric-trend">
        ✓ Modern formats
       </div>
      </div>
     </div>
    </div>
    <div class="summary-content" id="audio-content">
     <div class="metrics-grid">
      <div class="metric-card metric-green">
       <div class="metric-label">
        Pronunciations
       </div>
       <div class="metric-value">
        6,687
       </div>
       <div class="metric-subtitle">
        Native speaker recordings
       </div>
       <div class="metric-trend">
        ↑ 25.9 per article
       </div>
      </div>
      <div class="metric-card metric-green">
       <div class="metric-label">
        Languages Covered
       </div>
       <div class="metric-value">
        187
       </div>
       <div class="metric-subtitle">
        Diverse linguistic range
       </div>
       <div class="metric-trend">
        ✓ Global coverage
       </div>
      </div>
      <div class="metric-card metric-green">
       <div class="metric-label">
        Audio Quality
       </div>
       <div class="metric-value">
        120kbps
       </div>
       <div class="metric-subtitle">
        High-quality MP3 format
       </div>
       <div class="metric-trend">
        ✓ Professional
       </div>
      </div>
     </div>
    </div>
    <div class="summary-content" id="coverage-content">
     <div class="metrics-grid">
      <div class="metric-card metric-green">
       <div class="metric-label">
        Countries
       </div>
       <div class="metric-value">
        244
       </div>
       <div class="metric-subtitle">
        All UN member states
       </div>
       <div class="metric-trend">
        ✓ 100% complete
       </div>
      </div>
      <div class="metric-card metric-green">
       <div class="metric-label">
        Regions
       </div>
       <div class="metric-value">
        6
       </div>
       <div class="metric-subtitle">
        All continents covered
       </div>
       <div class="metric-trend">
        ✓ Global reach
       </div>
      </div>
      <div class="metric-card metric-green">
       <div class="metric-label">
        Cultures
       </div>
       <div class="metric-value">
        500+
       </div>
       <div class="metric-subtitle">
        Ethnic &amp; religious diversity
       </div>
       <div class="metric-trend">
        ✓ Inclusive
       </div>
      </div>
     </div>
    </div>
    <div class="summary-content" id="engagement-content">
     <div class="metrics-grid">
      <div class="metric-card metric-green">
       <div class="metric-label">
        Interactive Elements
       </div>
       <div class="metric-value">
        20K+
       </div>
       <div class="metric-subtitle">
        Clickable, playable content
       </div>
       <div class="metric-trend">
        ↑ High engagement
       </div>
      </div>
      <div class="metric-card metric-green">
       <div class="metric-label">
        Cross References
       </div>
       <div class="metric-value">
        3,200
       </div>
       <div class="metric-subtitle">
        Internal linking network
       </div>
       <div class="metric-trend">
        ↑ Better navigation
       </div>
      </div>
      <div class="metric-card metric-orange">
       <div class="metric-label">
        Social Shares
       </div>
       <div class="metric-value">
        Ready
       </div>
       <div class="metric-subtitle">
        OG tags &amp; Twitter cards
       </div>
       <div class="metric-trend">
        ✓ Share-optimized
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="stats-grid" id="stats-container">
    <!-- Stats will be populated by JavaScript -->
   </div>
   <div class="table-container">
    <div class="loading" id="loading">
     Loading data...
    </div>
    <div class="error" id="error" style="display: none;">
    </div>
    <table id="data-table" style="display: none;">
     <thead>
      <tr>
       <th onclick="sortTable(0)">
        Country
       </th>
       <th onclick="sortTable(1)">
        Article
       </th>
       <th onclick="sortTable(2)">
        Language
       </th>
       <th onclick="sortTable(3)">
        Words
       </th>
       <th onclick="sortTable(4)">
        Images
       </th>
       <th onclick="sortTable(5)">
        Pronunciations
       </th>
       <th onclick="sortTable(6)">
        Sections
       </th>
       <th onclick="sortTable(7)">
        FAQ's
       </th>
       <th>
        Entities
       </th>
       <th>
        CliffNotes
       </th>
      </tr>
     </thead>
     <tbody id="table-body">
      <!-- Data will be populated by JavaScript -->
     </tbody>
    </table>
   </div>
   <div class="data-timestamp">
    Data generated on September 04, 2025 at 03:55 AM
   </div>
  </div>
  <!-- Entity Modal -->
  <div class="modal" id="entityModal">
   <div class="modal-content">
    <div class="modal-header">
     <h2 id="modalTitle">
      Entities
     </h2>
     <span class="close">
      ×
     </span>
    </div>
    <div class="modal-body" id="modalBody">
     <div class="entities-loading">
      Loading entities...
     </div>
    </div>
   </div>
  </div>
  <!-- Documentation Modal -->
  <div class="modal" id="docModal">
   <div class="modal-content" style="max-width: 900px; height: 90vh;">
    <div class="modal-header">
     <h2 id="docModalTitle">
      Documentation
     </h2>
     <span class="doc-close" onclick="closeDocModal()">
      ×
     </span>
    </div>
    <div class="modal-body" id="docModalBody" style="overflow-y: auto; max-height: calc(90vh - 100px);">
     <div class="entities-loading">
      Loading documentation...
     </div>
    </div>
   </div>
  </div>
  <script>
   const PROD_URL_BASE = 'https://www.puravidaweddingplanner.com/wedding-customs';
        
        let currentData = [];
        let currentSort = { column: -1, ascending: true };
        let entitiesData = null;
        let cliffNotesData = null;
        
        // Country name to code mapping (add more as needed)
        const countryCodeMap = {
            'Afghanistan': 'AF',
            'Albania': 'AL',
            'Algeria': 'DZ',
            'United States': 'US',
            'Angola': 'AO',
            'Argentina': 'AR',
            'Armenia': 'AM',
            'Australia': 'AU',
            'Austria': 'AT',
            'Azerbaijan': 'AZ',
            'Bahamas': 'BS',
            'Bahrain': 'BH',
            'Bangladesh': 'BD',
            'Barbados': 'BB',
            'Belarus': 'BY',
            'Belgium': 'BE',
            'Belize': 'BZ',
            'Benin': 'BJ',
            'Bhutan': 'BT',
            'Bolivia': 'BO',
            'Bosnia and Herzegovina': 'BA',
            'Botswana': 'BW',
            'Brazil': 'BR',
            'Bulgaria': 'BG',
            'Burkina Faso': 'BF',
            'Burundi': 'BI',
            'Cambodia': 'KH',
            'Cameroon': 'CM',
            'Canada': 'CA',
            'Chad': 'TD',
            'Chile': 'CL',
            'China': 'CN',
            'Colombia': 'CO',
            'Congo': 'CG',
            'Costa Rica': 'CR',
            'Croatia': 'HR',
            'Cuba': 'CU',
            'Cyprus': 'CY',
            'Czech Republic': 'CZ',
            'Denmark': 'DK',
            'Dominican Republic': 'DO',
            'Ecuador': 'EC',
            'Egypt': 'EG',
            'El Salvador': 'SV',
            'Estonia': 'EE',
            'Ethiopia': 'ET',
            'Fiji': 'FJ',
            'Finland': 'FI',
            'France': 'FR',
            'Georgia': 'GE',
            'Germany': 'DE',
            'Ghana': 'GH',
            'Greece': 'GR',
            'Guatemala': 'GT',
            'Guinea': 'GN',
            'Guyana': 'GY',
            'Haiti': 'HT',
            'Honduras': 'HN',
            'Hungary': 'HU',
            'Iceland': 'IS',
            'India': 'IN',
            'Indonesia': 'ID',
            'Iran': 'IR',
            'Iraq': 'IQ',
            'Ireland': 'IE',
            'Israel': 'IL',
            'Italy': 'IT',
            'Jamaica': 'JM',
            'Japan': 'JP',
            'Jordan': 'JO',
            'Kazakhstan': 'KZ',
            'Kenya': 'KE',
            'Kuwait': 'KW',
            'Kyrgyzstan': 'KG',
            'Laos': 'LA',
            'Latvia': 'LV',
            'Lebanon': 'LB',
            'Liberia': 'LR',
            'Libya': 'LY',
            'Lithuania': 'LT',
            'Luxembourg': 'LU',
            'Macedonia': 'MK',
            'Madagascar': 'MG',
            'Malawi': 'MW',
            'Malaysia': 'MY',
            'Mali': 'ML',
            'Malta': 'MT',
            'Mexico': 'MX',
            'Moldova': 'MD',
            'Mongolia': 'MN',
            'Morocco': 'MA',
            'Mozambique': 'MZ',
            'Myanmar': 'MM',
            'Nepal': 'NP',
            'Netherlands': 'NL',
            'New Zealand': 'NZ',
            'Nicaragua': 'NI',
            'Niger': 'NE',
            'Nigeria': 'NG',
            'Norway': 'NO',
            'Pakistan': 'PK',
            'Panama': 'PA',
            'Paraguay': 'PY',
            'Peru': 'PE',
            'Philippines': 'PH',
            'Poland': 'PL',
            'Portugal': 'PT',
            'Qatar': 'QA',
            'Romania': 'RO',
            'Russia': 'RU',
            'Rwanda': 'RW',
            'Saudi Arabia': 'SA',
            'Senegal': 'SN',
            'Serbia': 'RS',
            'Singapore': 'SG',
            'Slovakia': 'SK',
            'Slovenia': 'SI',
            'Somalia': 'SO',
            'South Africa': 'ZA',
            'South Korea': 'KR',
            'Spain': 'ES',
            'Sri Lanka': 'LK',
            'Sudan': 'SD',
            'Sweden': 'SE',
            'Switzerland': 'CH',
            'Syria': 'SY',
            'Taiwan': 'TW',
            'Tanzania': 'TZ',
            'Thailand': 'TH',
            'Tunisia': 'TN',
            'Turkey': 'TR',
            'Uganda': 'UG',
            'Ukraine': 'UA',
            'United Arab Emirates': 'AE',
            'United Kingdom': 'GB',
            'Uruguay': 'UY',
            'Uzbekistan': 'UZ',
            'Venezuela': 'VE',
            'Vietnam': 'VN',
            'Yemen': 'YE',
            'Zambia': 'ZM',
            'Zimbabwe': 'ZW'
        };
        
        
        async function loadData() {
            try {
                const response = await fetch('data/content-details.json?t=' + Date.now());
                const nestedData = await response.json();
                
                // Convert nested structure to flat array
                currentData = [];
                if (Array.isArray(nestedData)) {
                    // Already flat array
                    currentData = nestedData;
                } else {
                    // Convert nested object to flat array
                    for (const [country, countryData] of Object.entries(nestedData)) {
                        if (countryData.articles) {
                            countryData.articles.forEach(article => {
                                currentData.push({
                                    ...article,
                                    country: country
                                });
                            });
                        }
                    }
                }
                
                // Load summary stats
                loadSummaryStats();
                
                // Load entities data BEFORE rendering table
                await loadEntitiesData();
                await loadCliffNotesData();
                
                // Apply default sort: article count desc, then country asc
                applyDefaultSort();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('data-table').style.display = 'table';
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Error loading data: ' + error.message;
            }
        }
        
        function applyDefaultSort() {
            // Group by country
            const grouped = {};
            currentData.forEach(item => {
                const country = item.country || 'Unknown';
                if (!grouped[country]) {
                    grouped[country] = [];
                }
                grouped[country].push(item);
            });
            
            // Sort countries by article count desc, then by name asc
            const sortedCountries = Object.keys(grouped).sort((a, b) => {
                const countDiff = grouped[b].length - grouped[a].length;
                return countDiff !== 0 ? countDiff : a.localeCompare(b);
            });
            
            // Rebuild data array in sorted order
            currentData = [];
            sortedCountries.forEach(country => {
                grouped[country].forEach(article => {
                    currentData.push(article);
                });
            });
            
            renderTable();
        }
        
        function renderTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            
            let lastCountry = '';
            let countryRowSpan = 0;
            let countryCell = null;
            
            // First pass: count articles per country
            const countryCounts = {};
            currentData.forEach(item => {
                const country = item.country || 'Unknown';
                countryCounts[country] = (countryCounts[country] || 0) + 1;
            });
            
            // Render rows
            currentData.forEach((item, index) => {
                const row = tbody.insertRow();
                const country = item.country || 'Unknown';
                
                // Country cell (with rowspan)
                if (country !== lastCountry) {
                    countryCell = row.insertCell();
                    countryCell.textContent = country;
                    countryCell.rowSpan = countryCounts[country];
                    countryCell.style.fontWeight = '600';
                    countryCell.style.verticalAlign = 'top';
                    lastCountry = country;
                }
                
                // Article with link
                const articleCell = row.insertCell();
                if (item.filename) {
                    const link = document.createElement('a');
                    link.href = `${PROD_URL_BASE}/${item.filename}`;
                    link.textContent = item.filename.replace('.html', '');
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    articleCell.appendChild(link);
                } else {
                    articleCell.textContent = item.article || 'Unknown';
                }
                
                // Other cells
                row.insertCell().textContent = item.language || 'en';
                row.insertCell().textContent = item.word_count || '0';
                row.insertCell().textContent = item.image_count || '0';
                row.insertCell().textContent = item.pronunciation_count || '0';
                row.insertCell().textContent = item.section_count || '0';
                row.insertCell().textContent = item.faq_count || '0';
                
                // Entities cell
                const entitiesCell = row.insertCell();
                const entityKey = getEntityKey(item);
                if (entitiesData && entitiesData[entityKey]) {
                    const btn = document.createElement('button');
                    btn.className = 'entity-btn';
                    btn.textContent = 'View';
                    btn.onclick = () => showEntities(item, entityKey);
                    entitiesCell.appendChild(btn);
                } else {
                    // Show more descriptive text for non-English articles
                    entitiesCell.textContent = item.language !== 'en' ? 'N/A' : '-';
                    entitiesCell.style.color = '#999';
                }
                
                // Cliff Notes cell
                const cliffNotesCell = row.insertCell();
                const cliffNotesKey = getEntityKey(item); // Same key format as entities
                if (cliffNotesData && cliffNotesData[cliffNotesKey]) {
                    const btn = document.createElement('button');
                    btn.className = 'entity-btn'; // Reuse same button style
                    btn.textContent = 'View';
                    btn.onclick = () => showCliffNotes(item, cliffNotesKey);
                    cliffNotesCell.appendChild(btn);
                } else {
                    // Show more descriptive text for non-English articles
                    cliffNotesCell.textContent = item.language !== 'en' ? 'N/A' : '-';
                    cliffNotesCell.style.color = '#999';
                }
            });
        }
        
        async function loadSummaryStats() {
            try {
                const response = await fetch('data/content-summary.json');
                const summary = await response.json();
                
                document.getElementById('stats-container').innerHTML = `
                    <div class="stat-card">
                        <h3>Total Articles</h3>
                        <div class="value">${summary.total_articles || 0}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Words</h3>
                        <div class="value">${(summary.total_words || 0).toLocaleString()}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Images</h3>
                        <div class="value">${summary.total_images || 0}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Pronunciations</h3>
                        <div class="value">${summary.total_pronunciations || 0}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total FAQs</h3>
                        <div class="value">${summary.total_faqs || 0}</div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading summary stats:', error);
            }
        }
        
        function sortTable(columnIndex) {
            // Toggle sort direction if same column
            if (currentSort.column === columnIndex) {
                currentSort.ascending = !currentSort.ascending;
            } else {
                currentSort.column = columnIndex;
                currentSort.ascending = true;
            }
            
            // Sort data
            currentData.sort((a, b) => {
                let aVal, bVal;
                
                switch(columnIndex) {
                    case 0: // Country
                        aVal = a.country || '';
                        bVal = b.country || '';
                        break;
                    case 1: // Article
                        aVal = a.filename || a.article || '';
                        bVal = b.filename || b.article || '';
                        break;
                    case 2: // Language
                        aVal = a.language || '';
                        bVal = b.language || '';
                        break;
                    case 3: // Words
                        aVal = parseInt(a.word_count) || 0;
                        bVal = parseInt(b.word_count) || 0;
                        break;
                    case 4: // Images
                        aVal = parseInt(a.image_count) || 0;
                        bVal = parseInt(b.image_count) || 0;
                        break;
                    case 5: // Pronunciations
                        aVal = parseInt(a.pronunciation_count) || 0;
                        bVal = parseInt(b.pronunciation_count) || 0;
                        break;
                    case 6: // Sections
                        aVal = parseInt(a.section_count) || 0;
                        bVal = parseInt(b.section_count) || 0;
                        break;
                    case 7: // FAQs
                        aVal = parseInt(a.faq_count) || 0;
                        bVal = parseInt(b.faq_count) || 0;
                        break;
                    default:
                        // For columns without sorting (8-9), maintain original order
                        return 0;
                }
                
                if (typeof aVal === 'string') {
                    return currentSort.ascending ? 
                        aVal.localeCompare(bVal) : 
                        bVal.localeCompare(aVal);
                } else {
                    return currentSort.ascending ? 
                        aVal - bVal : 
                        bVal - aVal;
                }
            });
            
            // Update header classes
            document.querySelectorAll('th').forEach((th, index) => {
                th.classList.remove('sort-asc', 'sort-desc');
                if (index === columnIndex) {
                    th.classList.add(currentSort.ascending ? 'sort-asc' : 'sort-desc');
                }
            });
            
            renderTable();
        }
        
        // switchView function removed - now using direct HTML links
        
        // Load data on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            
            // Set active class based on current page
            const currentPage = window.location.pathname.split('/').pop().replace('.html', '') || 'index';
            const toggleButtons = document.querySelectorAll('.toggle-btn');
            
            toggleButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-page') === currentPage) {
                    btn.classList.add('active');
                }
            });
        });
        
        // Load entities data
        async function loadEntitiesData() {
            try {
                const response = await fetch('data/entities-data.json');
                if (response.ok) {
                    entitiesData = await response.json();
                }
            } catch (error) {
                console.warn('Could not load entities data:', error);
            }
        }
        
        // Load cliff notes data
        async function loadCliffNotesData() {
            try {
                const response = await fetch('data/cliff-notes-data.json');
                if (response.ok) {
                    cliffNotesData = await response.json();
                }
            } catch (error) {
                console.warn('Could not load cliff notes data:', error);
            }
        }
        
        // Get entity key for an article
        function getEntityKey(item) {
            const lang = item.language || 'en';
            const countryName = item.country || '';
            
            // Entity/cliff notes data only exists for English articles
            if (lang !== 'en') {
                return null;
            }
            
            // Get country code from mapping
            const countryCode = countryCodeMap[countryName];
            
            if (countryCode) {
                // Use country code format (e.g., "US-en")
                return `${countryCode}-${lang}`;
            }
            
            // Fallback: try to find by matching country name in entities data
            for (const key in entitiesData || {}) {
                if (key.endsWith(`-${lang}`)) {
                    const data = entitiesData[key];
                    if (data.country && data.country.toLowerCase() === countryName.toLowerCase()) {
                        return key;
                    }
                }
            }
            
            return null;
        }
        
        // Show entities modal
        function showEntities(item, entityKey) {
            const modal = document.getElementById('entityModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = `Entities - ${item.country} (${(item.language || 'en').toUpperCase()})`;
            modalBody.innerHTML = '<div class="entities-loading">Loading entities...</div>';
            modal.style.display = 'block';
            
            if (entitiesData && entitiesData[entityKey]) {
                const data = entitiesData[entityKey];
                displayEntities(data.entities, modalBody);
            } else {
                modalBody.innerHTML = '<p style="text-align: center; color: #666;">No entities found for this article.</p>';
            }
        }
        
        // Display entities in modal
        function displayEntities(entities, container) {
            let html = '';
            let totalCount = 0;
            
            // Calculate total
            for (const items of Object.values(entities)) {
                if (Array.isArray(items)) {
                    totalCount += items.length;
                }
            }
            
            html += `<div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                        <strong>Total Entities:</strong> ${totalCount}
                    </div>`;
            
            // Display by category
            for (const [category, items] of Object.entries(entities)) {
                if (items && items.length > 0) {
                    const categoryName = category
                        .replace(/_/g, ' ')
                        .replace(/\b\w/g, l => l.toUpperCase());
                    
                    html += `
                        <div class="entity-section">
                            <h3>${categoryName} <span class="entity-count">(${items.length})</span></h3>
                            <ul class="entity-list">
                                ${items.map(item => {
                                    if (typeof item === 'object' && item.term) {
                                        return `<li><strong>${item.term}</strong>${item.description ? ` - ${item.description}` : ''}</li>`;
                                    } else {
                                        return `<li>${item}</li>`;
                                    }
                                }).join('')}
                            </ul>
                        </div>
                    `;
                }
            }
            
            container.innerHTML = html || '<p>No entities found.</p>';
        }
        
        // Show cliff notes modal
        function showCliffNotes(item, cliffNotesKey) {
            const modal = document.getElementById('entityModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = `Cliff Notes - ${item.country} (${(item.language || 'en').toUpperCase()})`;
            modalBody.innerHTML = '<div class="entities-loading">Loading cliff notes...</div>';
            modal.style.display = 'block';
            
            if (cliffNotesData && cliffNotesData[cliffNotesKey]) {
                const data = cliffNotesData[cliffNotesKey];
                displayCliffNotes(data.cliff_notes, modalBody);
            } else {
                modalBody.innerHTML = '<p style="text-align: center; color: #666;">No cliff notes found for this article.</p>';
            }
        }
        
        // Display cliff notes in modal
        function displayCliffNotes(cliffNotes, container) {
            let html = '<div class="cliff-notes-content">';
            
            if (cliffNotes.bullet_points && cliffNotes.bullet_points.length > 0) {
                html += '<ul style="list-style: none; padding: 0;">';
                cliffNotes.bullet_points.forEach(point => {
                    html += `<li style="margin-bottom: 12px; padding-left: 20px; position: relative;">
                        <span style="position: absolute; left: 0;">•</span>
                        ${point}
                    </li>`;
                });
                html += '</ul>';
            } else if (cliffNotes.summary) {
                html += `<div style="white-space: pre-wrap;">${cliffNotes.summary}</div>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // Modal close functionality
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('entityModal');
            const closeBtn = document.querySelector('.close');
            
            closeBtn.onclick = () => {
                modal.style.display = 'none';
            };
            
            window.onclick = (event) => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
                if (event.target === document.getElementById('docModal')) {
                    closeDocModal();
                }
            };
        });
        
        // Documentation view function removed - replaced by direct workflow view
        
        // Documentation viewer functionality
        async function viewDocument(docType) {
            const modal = document.getElementById('docModal');
            const modalTitle = document.getElementById('docModalTitle');
            const modalBody = document.getElementById('docModalBody');
            
            const docMap = {
                'workflow': {
                    title: 'Pipeline Workflow Status',
                    content: await getWorkflowContent()
                },
                'backend': {
                    title: 'Backend API Engineer',
                    content: getBackendContent()
                },
                'frontend': {
                    title: 'Frontend UX Optimizer',
                    content: getFrontendContent()
                },
                'qa': {
                    title: 'QA Tester',
                    content: getQAContent()
                },
                'deploy': {
                    title: 'Deployment Automation',
                    content: getDeployContent()
                }
            };
            
            const doc = docMap[docType];
            if (doc) {
                modalTitle.textContent = doc.title;
                modalBody.innerHTML = '<div class="entities-loading">Loading workflow data...</div>';
                modal.style.display = 'block';
                
                // Load content asynchronously
                setTimeout(async () => {
                    const content = await doc.content;
                    modalBody.innerHTML = content;
                }, 0);
            }
        }
        
        function closeDocModal() {
            document.getElementById('docModal').style.display = 'none';
        }
        
        // Documentation content functions
        async function getWorkflowContent() {
            try {
                const response = await fetch('data/workflow-stats.json?t=' + Date.now());
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                const formatTime = (timestamp) => {
                    const date = new Date(timestamp);
                    return date.toLocaleString();
                };
                
                const getStatusColor = (status) => {
                    switch(status.toLowerCase()) {
                        case 'success': case 'complete': return '#16a34a';
                        case 'warning': return '#ea580c';
                        case 'failed': case 'error': return '#dc2626';
                        case 'idle': return '#6b7280';
                        case 'running': return '#2563eb';
                        default: return '#6b7280';
                    }
                };
                
                const getStatusIcon = (status) => {
                    switch(status.toLowerCase()) {
                        case 'success': case 'complete': return '✅';
                        case 'warning': return '⚠️';
                        case 'failed': case 'error': return '❌';
                        case 'idle': return '⏸️';
                        case 'running': return '▶️';
                        default: return '•';
                    }
                };
                
                return `
<div style="padding: 20px; font-family: 'Raleway', sans-serif;">
    <h2 style="margin-bottom: 30px; color: #1a1a1a;">Pipeline Workflow Status</h2>
    
    <!-- Overall Status -->
    <div style="background: linear-gradient(135deg, #f8f9fb 0%, #ffffff 100%); padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
            <div>
                <h3 style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">Pipeline Status</h3>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">${getStatusIcon(data.pipeline_status.overall_status)}</span>
                    <span style="font-size: 28px; font-weight: 700; color: ${getStatusColor(data.pipeline_status.overall_status)};">${data.pipeline_status.overall_status}</span>
                </div>
            </div>
            <div>
                <h3 style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">Last Run</h3>
                <div style="font-size: 16px;">${formatTime(data.pipeline_status.last_run)}</div>
                <div style="font-size: 14px; color: #6b7280;">Duration: ${data.pipeline_status.last_run_duration}</div>
            </div>
            <div>
                <h3 style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">Success Rate</h3>
                <div style="font-size: 32px; font-weight: 700; color: ${data.pipeline_status.success_rate >= 95 ? '#16a34a' : '#ea580c'};">${data.pipeline_status.success_rate}%</div>
            </div>
            <div>
                <h3 style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">Runs Today</h3>
                <div style="font-size: 24px; font-weight: 600;">${data.pipeline_status.total_runs_today}</div>
            </div>
        </div>
    </div>
    
    <!-- Active Processes -->
    <div style="background: white; padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <h3 style="margin-bottom: 20px; color: #1a1a1a;">Active Processes</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
            <div style="text-align: center; padding: 15px; background: #f8f9fb; border-radius: 8px;">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">Build Queue</div>
                <div style="font-size: 24px; font-weight: 700; color: ${data.active_processes.build_queue > 0 ? '#ea580c' : '#16a34a'};">${data.active_processes.build_queue}</div>
            </div>
            <div style="text-align: center; padding: 15px; background: #f8f9fb; border-radius: 8px;">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">Running Scripts</div>
                <div style="font-size: 24px; font-weight: 700; color: ${data.active_processes.running_scripts > 0 ? '#2563eb' : '#6b7280'};">${data.active_processes.running_scripts}</div>
            </div>
            <div style="text-align: center; padding: 15px; background: #f8f9fb; border-radius: 8px;">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">Errors</div>
                <div style="font-size: 24px; font-weight: 700; color: ${data.active_processes.errors_count > 0 ? '#dc2626' : '#16a34a'};">${data.active_processes.errors_count}</div>
            </div>
            <div style="text-align: center; padding: 15px; background: #f8f9fb; border-radius: 8px;">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">Warnings</div>
                <div style="font-size: 24px; font-weight: 700; color: ${data.active_processes.warnings_count > 0 ? '#ea580c' : '#16a34a'};">${data.active_processes.warnings_count}</div>
            </div>
        </div>
    </div>
    
    <!-- Pipeline Stages -->
    <div style="background: white; padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <h3 style="margin-bottom: 20px; color: #1a1a1a;">Pipeline Stages Overview</h3>
        <div style="display: grid; gap: 15px;">
            ${Object.entries(data.pipeline_stages).map(([stage, info]) => `
                <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8f9fb; border-radius: 8px; border-left: 4px solid ${getStatusColor(info.status)};">
                    <div style="font-size: 20px;">${getStatusIcon(info.status)}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; text-transform: capitalize;">${stage.replace(/_/g, ' ')}</div>
                        <div style="font-size: 14px; color: #6b7280;">Duration: ${info.duration}</div>
                    </div>
                    <div style="text-align: right; font-size: 14px; color: #6b7280;">
                        ${formatTime(info.last_run).split(',')[1]}
                    </div>
                </div>
            `).join('')}
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div style="background: white; padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <h3 style="margin-bottom: 20px; color: #1a1a1a;">Recent Activity</h3>
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fb;">
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #6b7280;">Time</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #6b7280;">Type</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #6b7280;">Status</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #6b7280;">Duration</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: #6b7280;">Details</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.recent_activity.slice(0, 5).map(activity => `
                        <tr style="border-bottom: 1px solid #e8ecf1;">
                            <td style="padding: 12px; font-size: 14px;">${formatTime(activity.timestamp)}</td>
                            <td style="padding: 12px; font-size: 14px;">${activity.type}</td>
                            <td style="padding: 12px; font-size: 14px;">
                                <span style="display: inline-flex; align-items: center; gap: 5px; color: ${getStatusColor(activity.status)};">
                                    ${getStatusIcon(activity.status)} ${activity.status}
                                </span>
                            </td>
                            <td style="padding: 12px; font-size: 14px;">${activity.duration}</td>
                            <td style="padding: 12px; font-size: 14px; color: #6b7280;">${activity.trigger}${activity.countries > 0 ? ` (${activity.countries} countries)` : ''}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <h3 style="margin-bottom: 20px; color: #1a1a1a;">Quick Actions</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            ${data.quick_actions.map(action => `
                <div style="padding: 15px; background: #f8f9fb; border-radius: 8px; border: 1px solid #e8ecf1;">
                    <div style="font-weight: 600; margin-bottom: 5px;">${action.action}</div>
                    <code style="display: block; font-size: 12px; padding: 8px; background: #1a1a1a; color: #16a34a; border-radius: 4px; margin: 8px 0;">${action.command}</code>
                    <div style="font-size: 12px; color: #6b7280;">⏱️ ${action.estimated_time}</div>
                </div>
            `).join('')}
        </div>
    </div>
    
    <!-- Warnings -->
    ${data.warnings && data.warnings.length > 0 ? `
    <div style="background: #fffcf8; border: 1px solid #fbbf24; padding: 20px; border-radius: 12px; margin-top: 30px;">
        <h3 style="margin-bottom: 15px; color: #ea580c;">⚠️ Active Warnings</h3>
        ${data.warnings.map(warning => `
            <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #fed7aa;">
                <div style="font-weight: 600; color: #ea580c;">${warning.type}</div>
                <div style="font-size: 14px; margin: 5px 0;">${warning.message}</div>
                <div style="font-size: 12px; color: #92400e;">Severity: ${warning.severity} • ${formatTime(warning.timestamp)}</div>
            </div>
        `).join('')}
    </div>
    ` : ''}
</div>
`;
            } catch (error) {
                console.error('Error loading workflow data:', error);
                // Return fallback content with sample data
                return getFallbackWorkflowContent(error.message);
            }
        }
        
        function getFallbackWorkflowContent(errorMsg) {
            return `
<div style="padding: 20px; font-family: 'Raleway', sans-serif;">
    <h2 style="margin-bottom: 30px; color: #1a1a1a;">Pipeline Workflow Status</h2>
    
    <div style="background: #fff5f5; border: 1px solid #feb2b2; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <strong style="color: #dc2626;">Unable to load live data:</strong> ${errorMsg}
        <div style="font-size: 14px; color: #7f1d1d; margin-top: 5px;">Showing sample workflow data instead</div>
    </div>
    
    <!-- Sample Status -->
    <div style="background: linear-gradient(135deg, #f8f9fb 0%, #ffffff 100%); padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
            <div>
                <h3 style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">Pipeline Status</h3>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">⏸️</span>
                    <span style="font-size: 28px; font-weight: 700; color: #6b7280;">Idle</span>
                </div>
            </div>
            <div>
                <h3 style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">Success Rate</h3>
                <div style="font-size: 32px; font-weight: 700; color: #16a34a;">97.8%</div>
            </div>
        </div>
    </div>
    
    <!-- Sample Pipeline Stages -->
    <div style="background: white; padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <h3 style="margin-bottom: 20px; color: #1a1a1a;">Pipeline Stages Overview</h3>
        <div style="display: grid; gap: 15px;">
            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8f9fb; border-radius: 8px; border-left: 4px solid #16a34a;">
                <div style="font-size: 20px;">✅</div>
                <div style="flex: 1;">
                    <div style="font-weight: 600;">Requirements Validation</div>
                    <div style="font-size: 14px; color: #6b7280;">Duration: 1.2s</div>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8f9fb; border-radius: 8px; border-left: 4px solid #16a34a;">
                <div style="font-size: 20px;">✅</div>
                <div style="flex: 1;">
                    <div style="font-weight: 600;">HTML Generation</div>
                    <div style="font-size: 14px; color: #6b7280;">Duration: 85.3s</div>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8f9fb; border-radius: 8px; border-left: 4px solid #16a34a;">
                <div style="font-size: 20px;">✅</div>
                <div style="flex: 1;">
                    <div style="font-weight: 600;">Deployment</div>
                    <div style="font-size: 14px; color: #6b7280;">Duration: 34.5s</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <h3 style="margin-bottom: 20px; color: #1a1a1a;">Quick Actions</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div style="padding: 15px; background: #f8f9fb; border-radius: 8px; border: 1px solid #e8ecf1;">
                <div style="font-weight: 600; margin-bottom: 5px;">Run Full Pipeline</div>
                <code style="display: block; font-size: 12px; padding: 8px; background: #1a1a1a; color: #16a34a; border-radius: 4px; margin: 8px 0;">python3 _build_pipeline.py</code>
                <div style="font-size: 12px; color: #6b7280;">⏱️ 3-4 minutes</div>
            </div>
            <div style="padding: 15px; background: #f8f9fb; border-radius: 8px; border: 1px solid #e8ecf1;">
                <div style="font-weight: 600; margin-bottom: 5px;">Check Status</div>
                <code style="display: block; font-size: 12px; padding: 8px; background: #1a1a1a; color: #16a34a; border-radius: 4px; margin: 8px 0;">python3 scripts/check_db_status.py</code>
                <div style="font-size: 12px; color: #6b7280;">⏱️ 2 seconds</div>
            </div>
        </div>
    </div>
</div>
`;
        }
        
        function getBackendContent() {
            return `<h2>Backend API Engineer</h2>

<h3>Role</h3>
Handles data, APIs, database operations for the wedding traditions pipeline.

<h3>Core Responsibilities</h3>
• Database Operations - Query and update wedding traditions data
• API Development - Create and maintain data endpoints
• Data Validation - Ensure data integrity and accuracy
• Performance Optimization - Optimize queries and responses
• Error Handling - Graceful error management

<h3>Communication Protocol</h3>
Outputs structured JSON with:
• data_structures - Prepared content
• api_endpoints - Available endpoints
• database_state - Current state and backups
• test_data - Sample responses`;
        }
        
        function getFrontendContent() {
            return `<h2>Frontend UX Optimizer</h2>

<h3>Role</h3>
Implements UI changes, optimizes user experience, ensures visual consistency.

<h3>Core Responsibilities</h3>
• UI Implementation - Build responsive interfaces
• Performance Optimization - Fast load times
• Accessibility - WCAG compliance
• Visual Consistency - Match design mockups
• Cross-browser Support - Test all major browsers

<h3>Communication Protocol</h3>
Outputs structured JSON with:
• ui_changes - Components modified
• visual_changes - Before/after screenshots
• performance_impact - Size and speed metrics
• test_instructions - What QA should verify`;
        }
        
        function getQAContent() {
            return `<h2>QA Tester</h2>

<h3>Role</h3>
Comprehensive testing and validation of all changes before and after deployment.

<h3>Core Responsibilities</h3>
• Pre-deployment Testing - Validate all changes locally
• Visual Testing - Screenshot comparisons
• Performance Testing - Lighthouse scores 95+
• Link Validation - Check all links work
• Pixel-Perfect CSS - Measure exact dimensions
• Color Validation - Verify brand consistency
• Live Testing - Post-deployment verification

<h3>Testing Protocol</h3>
• Screenshot comparison (before/after)
• All links return proper status codes
• CSS measurements documented
• Git diff analysis for changes
• Report results to user after live testing`;
        }
        
        function getDeployContent() {
            return `<h2>Deployment Automation</h2>

<h3>Role</h3>
Handles complete deployment process including backups, transfers, and verification.

<h3>Core Responsibilities</h3>
• Pre-deployment Checks - Verify files exist
• Backup Creation - Timestamped backups
• HTML Deployment - Two-stage rsync process
• CDN Asset Deployment - CSS/JS/images
• Post-deployment Verification - Test with Playwright
• Report to QA - Request live testing

<h3>Deployment Process</h3>
1. Create backups
2. Stage files to nimda home
3. Move to production with permissions
4. Deploy assets to CDN
5. Verify deployment
6. Report success to QA for live testing`;
        }
  </script>
  <!-- Tab Switching JavaScript -->
  <script>
   function showSummaryTab(tabName) {
            // Hide all content
            document.querySelectorAll('.summary-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected content
            const selectedContent = document.getElementById(tabName + '-content');
            if (selectedContent) {
                selectedContent.classList.add('active');
            }
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            if (event && event.target) {
                event.target.closest('.tab').classList.add('active');
            }
        }
        
        
// Enhanced Dashboard Data Loading and Display
// Fixes duplicate event listeners and connects all available data

// Global data cache
let dashboardDataCache = {};

// Single DOMContentLoaded listener
document.addEventListener('DOMContentLoaded', function() {
    initializeDashboard();
});

async function initializeDashboard() {
    try {
        // Load all relevant data files
        await loadDashboardData();
        
        // Update all metrics
        updateAllMetrics();
        
        // Initialize tab switching with data updates
        initializeTabSwitching();
        
    } catch (error) {
        console.error('Dashboard initialization error:', error);
        showError('Failed to load dashboard data: ' + error.message);
    }
}

async function loadDashboardData() {
    const path = window.location.pathname;
    let dashboardType = 'index';
    
    if (path.includes('api.html')) {
        dashboardType = 'api';
    } else if (path.includes('inlinks.html')) {
        dashboardType = 'inlinks';
    }
    
    // Load appropriate data files based on dashboard type
    const dataFiles = {
        'api': [
            'data/api-summary.json',
            'data/api-details.json',
            'data/lighthouse-summary.json',
            'data/dashboard-stats.json'
        ],
        'index': [
            'data/content-summary.json',
            'data/content-details.json',
            'data/dashboard-stats.json'
        ],
        'inlinks': [
            'data/inlinks-internal-summary.json',
            'data/inlinks-external-summary.json',
            'data/inlinks-internal-details.json',
            'data/inlinks-external-details.json',
            'data/dashboard-stats.json'
        ]
    };
    
    // Load all data files
    for (const dataFile of dataFiles[dashboardType] || []) {
        try {
            const response = await fetch(dataFile);
            if (response.ok) {
                const data = await response.json();
                const fileName = dataFile.split('/').pop().replace('.json', '');
                dashboardDataCache[fileName] = data;
            }
        } catch (error) {
            console.warn(`Failed to load ${dataFile}:`, error);
        }
    }
}

function updateAllMetrics() {
    const path = window.location.pathname;
    
    if (path.includes('api.html')) {
        updateAPIMetrics();
    } else if (path.includes('index.html')) {
        updateContentMetrics();
    } else if (path.includes('inlinks.html')) {
        updateInlinksMetrics();
    }
}

function updateAPIMetrics() {
    const apiSummary = dashboardDataCache['api-summary'] || {};
    const lighthouseSummary = dashboardDataCache['lighthouse-summary'] || {};
    const dashboardStats = dashboardDataCache['dashboard-stats'] || {};
    
    // Update main tab scores
    if (apiSummary.avg_performance || lighthouseSummary.avg_performance) {
        const score = Math.round(apiSummary.avg_performance || lighthouseSummary.avg_performance || 
                                dashboardStats.performance?.lighthouse?.average_performance || 85);
        updateElement('perfScore', score);
    }
    
    if (apiSummary.avg_accessibility || lighthouseSummary.avg_accessibility) {
        const score = Math.round(apiSummary.avg_accessibility || lighthouseSummary.avg_accessibility || 
                                dashboardStats.performance?.lighthouse?.average_accessibility || 94);
        updateElement('a11yScore', score);
    }
    
    if (apiSummary.avg_best_practices || lighthouseSummary.avg_best_practices) {
        const score = Math.round(apiSummary.avg_best_practices || lighthouseSummary.avg_best_practices || 
                                dashboardStats.performance?.lighthouse?.average_best_practices || 94);
        updateElement('bpScore', score);
    }
    
    if (apiSummary.avg_seo || lighthouseSummary.avg_seo) {
        const score = Math.round(apiSummary.avg_seo || lighthouseSummary.avg_seo || 
                                dashboardStats.performance?.lighthouse?.average_seo || 98);
        updateElement('seoScore', score);
    }
    
    // Calculate Core Web Vitals Score
    const vitalsScore = calculateCoreWebVitalsScore(dashboardStats);
    updateElement('vitalsScore', vitalsScore);
    
    // Update performance distribution cards
    updatePerformanceDistribution(lighthouseSummary);
    
    // Update Core Vitals specific metrics
    updateCoreVitalsMetrics(dashboardStats);
    
    // Update additional metrics not currently shown
    updateAdditionalAPIMetrics(dashboardStats);
}

function calculateCoreWebVitalsScore(stats) {
    if (!stats.performance?.core_web_vitals) return 91;
    
    const cwv = stats.performance.core_web_vitals;
    let score = 0;
    let count = 0;
    
    // FCP scoring (target < 1.8s)
    if (cwv.average_fcp) {
        count++;
        if (cwv.average_fcp <= 1800) score += 100;
        else if (cwv.average_fcp <= 3000) score += 50;
        else score += 0;
    }
    
    // LCP scoring (target < 2.5s)
    if (cwv.average_lcp) {
        count++;
        if (cwv.average_lcp <= 2500) score += 100;
        else if (cwv.average_lcp <= 4000) score += 50;
        else score += 0;
    }
    
    // CLS scoring (target < 0.1)
    if (cwv.average_cls !== undefined) {
        count++;
        if (cwv.average_cls <= 0.1) score += 100;
        else if (cwv.average_cls <= 0.25) score += 50;
        else score += 0;
    }
    
    // TTI scoring (target < 3.8s)
    if (cwv.average_tti) {
        count++;
        if (cwv.average_tti <= 3800) score += 100;
        else if (cwv.average_tti <= 7300) score += 50;
        else score += 0;
    }
    
    return count > 0 ? Math.round(score / count) : 91;
}

function updatePerformanceDistribution(summary) {
    if (summary.score_categories) {
        // Update performance tab cards
        const perfContent = document.getElementById('performance-content');
        if (perfContent) {
            const cards = perfContent.querySelectorAll('.metric-card');
            
            // Update Articles Above 90
            if (cards[0]) {
                const value = cards[0].querySelector('.metric-value');
                const subtitle = cards[0].querySelector('.metric-subtitle');
                if (value) value.textContent = summary.score_categories.good || 180;
                if (subtitle) subtitle.textContent = `Out of ${summary.total_articles || 258} total`;
            }
            
            // Update Articles 50-89
            if (cards[1]) {
                const value = cards[1].querySelector('.metric-value');
                if (value) value.textContent = summary.score_categories.needs_work || 65;
            }
            
            // Update Articles Below 50
            if (cards[2]) {
                const value = cards[2].querySelector('.metric-value');
                if (value) value.textContent = summary.score_categories.poor || 13;
            }
        }
    }
}

function updateCoreVitalsMetrics(stats) {
    const vitalsContent = document.getElementById('vitals-content');
    if (!vitalsContent || !stats.performance?.core_web_vitals) return;
    
    const cwv = stats.performance.core_web_vitals;
    const cards = vitalsContent.querySelectorAll('.metric-card');
    
    // Update FCP
    if (cards[0] && cwv.average_fcp) {
        const value = cards[0].querySelector('.metric-value');
        if (value) value.textContent = (cwv.average_fcp / 1000).toFixed(1) + 's';
    }
    
    // Update LCP
    if (cards[1] && cwv.average_lcp) {
        const value = cards[1].querySelector('.metric-value');
        if (value) value.textContent = (cwv.average_lcp / 1000).toFixed(1) + 's';
    }
    
    // Update TTI
    if (cards[2] && cwv.average_tti) {
        const value = cards[2].querySelector('.metric-value');
        const subtitle = cards[2].querySelector('.metric-subtitle');
        if (value) value.textContent = (cwv.average_tti / 1000).toFixed(1) + 's';
        if (subtitle) subtitle.textContent = `Average TTI - target < 3.8s`;
    }
}

function updateAdditionalAPIMetrics(stats) {
    // Add new metric cards for page size data if available
    if (stats.performance?.page_size) {
        const pageSize = stats.performance.page_size;
        
        // Could add these to a new tab or expand existing tabs
        console.log('Page size metrics available:', {
            average: formatBytes(pageSize.average_total_size),
            largest: `${pageSize.largest_page.country} (${formatBytes(pageSize.largest_page.size)})`,
            smallest: `${pageSize.smallest_page.country} (${formatBytes(pageSize.smallest_page.size)})`
        });
    }
    
    // Load time metrics
    if (stats.technical?.optimization?.load_times) {
        console.log('Load time metrics available:', stats.technical.optimization.load_times);
    }
}

function updateContentMetrics() {
    const contentSummary = dashboardDataCache['content-summary'] || {};
    const dashboardStats = dashboardDataCache['dashboard-stats'] || {};
    
    // Update tab metrics with exact values
    if (contentSummary.total_articles || dashboardStats.overview?.total_articles) {
        updateElement('articlesCount', contentSummary.total_articles || dashboardStats.overview.total_articles || 258);
    }
    
    // Show exact image count
    if (contentSummary.total_images || dashboardStats.overview?.total_images) {
        const count = contentSummary.total_images || dashboardStats.overview.total_images || 10486;
        updateElement('imagesCount', count.toLocaleString());
    }
    
    // Show exact audio count
    if (contentSummary.total_pronunciations || dashboardStats.overview?.total_pronunciations) {
        const count = contentSummary.total_pronunciations || dashboardStats.overview.total_pronunciations || 6687;
        updateElement('audioCount', count.toLocaleString());
    }
    
    // Calculate real coverage
    const countries = dashboardStats.overview?.total_countries || 244;
    const coverage = Math.round((countries / 244) * 100);
    updateElement('coveragePercent', coverage + '%');
    
    // Calculate engagement score based on media richness
    const engagementScore = calculateEngagementScore(dashboardStats);
    updateElement('engagementScore', engagementScore);
    
    // Update content tab cards with real data
    updateContentTabCards(dashboardStats);
    
    // Update media tab with WebP conversion progress
    updateMediaTabCards(dashboardStats);
}

function calculateEngagementScore(stats) {
    if (!stats.overview) return 94;
    
    const totalMedia = (stats.overview.total_images || 0) + (stats.overview.total_pronunciations || 0);
    const articles = stats.overview.total_articles || 1;
    const mediaPerArticle = totalMedia / articles;
    
    // Base score on media richness, FAQ coverage, and content completeness
    let score = 50; // Base score
    
    // Media richness (up to 30 points)
    score += Math.min(30, mediaPerArticle * 0.5);
    
    // FAQ coverage (up to 10 points)
    if (stats.health?.content_completeness?.faq_coverage === "100%") score += 10;
    
    // Audio coverage (up to 10 points)
    const audioCoverage = parseFloat(stats.health?.content_completeness?.audio_coverage) || 0;
    score += (audioCoverage / 100) * 10;
    
    return Math.min(100, Math.round(score));
}

function updateContentTabCards(stats) {
    // Update Media tab with WebP conversion info
    const mediaContent = document.getElementById('media-content');
    if (mediaContent && stats.content?.media?.images) {
        const images = stats.content.media.images;
        
        // Add WebP conversion card if not exists
        const cards = mediaContent.querySelectorAll('.metric-card');
        if (cards.length >= 3) {
            // Update the third card with WebP info
            const webpCard = cards[2];
            const label = webpCard.querySelector('.metric-label');
            const value = webpCard.querySelector('.metric-value');
            const subtitle = webpCard.querySelector('.metric-subtitle');
            
            if (label) label.textContent = 'WebP Optimized';
            if (value) value.textContent = images.webp_available?.toLocaleString() || '4,925';
            if (subtitle) subtitle.textContent = `${Math.round((images.webp_available / images.total) * 100)}% converted`;
        }
    }
    
    // Update Coverage tab with real metrics
    const coverageContent = document.getElementById('coverage-content');
    if (coverageContent && stats.overview) {
        const cards = coverageContent.querySelectorAll('.metric-card');
        
        if (cards[0]) {
            const value = cards[0].querySelector('.metric-value');
            if (value) value.textContent = stats.overview.total_countries || 244;
        }
    }
}

function updateMediaTabCards(stats) {
    if (!stats.content?.media) return;
    
    const mediaContent = document.getElementById('media-content');
    if (!mediaContent) return;
    
    // Create additional info display
    const mediaInfo = document.createElement('div');
    mediaInfo.className = 'media-additional-info';
    mediaInfo.style.cssText = 'margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;';
    
    mediaInfo.innerHTML = `
        <h4 style="margin-bottom: 10px; color: #666;">Additional Media Metrics</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
                <strong>Total Media Size:</strong> ${stats.content.media.images.total_size_mb}MB
            </div>
            <div>
                <strong>External Links:</strong> ${stats.content.media.external.total_external_links.toLocaleString()}
            </div>
            <div>
                <strong>YouTube Embeds:</strong> ${stats.content.media.external.youtube_embeds}
            </div>
            <div>
                <strong>Audio Coverage:</strong> ${stats.content.media.audio.coverage}
            </div>
        
    <!-- Build Performance Tab -->
    <div class="summary-content" id="build-content" style="display: none;">
        <div class="metrics-grid">
            <div class="metric-card metric-green">
                <div class="metric-label">Average Build Time</div>
                <div class="metric-value" id="avgBuildTime">0.85s</div>
                <div class="metric-subtitle">Per article</div>
                <div class="metric-trend">↑ Fast</div>
            </div>
            <div class="metric-card metric-green">
                <div class="metric-label">Total Build Time</div>
                <div class="metric-value" id="totalBuildTime">3.5min</div>
                <div class="metric-subtitle">All 258 articles</div>
                <div class="metric-trend">✓ Efficient</div>
            </div>
            <div class="metric-card metric-orange">
                <div class="metric-label">Build Scripts</div>
                <div class="metric-value" id="buildScripts">442</div>
                <div class="metric-subtitle">Total scripts in pipeline</div>
                <div class="metric-trend">Well organized</div>
            </div>
        </div>
        
        <!-- Script Breakdown -->
        <div class="script-breakdown" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
            <h3 style="font-size: 1.4em; margin-bottom: 20px; color: #1a1a1a;">Pipeline Script Distribution</h3>
            <div class="script-categories" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <div class="script-cat">
                    <div style="font-size: 12px; color: #6b7280;">Build Scripts</div>
                    <div style="font-size: 20px; font-weight: 600;">52</div>
                </div>
                <div class="script-cat">
                    <div style="font-size: 12px; color: #6b7280;">Data Scripts</div>
                    <div style="font-size: 20px; font-weight: 600;">98</div>
                </div>
                <div class="script-cat">
                    <div style="font-size: 12px; color: #6b7280;">API Scripts</div>
                    <div style="font-size: 20px; font-weight: 600;">24</div>
                </div>
                <div class="script-cat">
                    <div style="font-size: 12px; color: #6b7280;">Test Scripts</div>
                    <div style="font-size: 20px; font-weight: 600;">45</div>
                </div>
                <div class="script-cat">
                    <div style="font-size: 12px; color: #6b7280;">Deployment</div>
                    <div style="font-size: 20px; font-weight: 600;">38</div>
                </div>
            </div>
        </div>
    </div>
    
        </div>
     `;
    
    // Add if not already present
    if (!mediaContent.querySelector('.media-additional-info')) {
        mediaContent.appendChild(mediaInfo);
    }
}

function updateInlinksMetrics() {
    const internalSummary = dashboardDataCache['inlinks-internal-summary'] || {};
    const externalSummary = dashboardDataCache['inlinks-external-summary'] || {};
    const dashboardStats = dashboardDataCache['dashboard-stats'] || {};
    
    // Update tab metrics
    if (internalSummary.total_links) {
        updateElement('internalCount', (internalSummary.total_links / 1000).toFixed(1) + 'K');
    }
    
    if (externalSummary.total_links) {
        updateElement('externalCount', (externalSummary.total_links / 1000).toFixed(1) + 'K');
    }
    
    // Calculate and update scores
    const structureScore = calculateStructureScore(internalSummary, dashboardStats);
    updateElement('structureScore', structureScore);
    
    const qualityScore = calculateQualityScore(internalSummary, externalSummary);
    updateElement('qualityScore', qualityScore);
    
    const distScore = calculateDistributionScore(internalSummary);
    updateElement('distScore', distScore);
    
    // Update tab content with real metrics
    updateInlinksTabContent(internalSummary, externalSummary, dashboardStats);
}

function calculateStructureScore(internal, stats) {
    // Base score
    let score = 80;
    
    // Good if we have many internal links
    if (internal.total_links > 40000) score += 10;
    
    // Good if average links per article is balanced
    const avgLinks = internal.total_links / (internal.total_articles || 1);
    if (avgLinks > 150 && avgLinks < 200) score += 10;
    
    return Math.min(100, score);
}

function calculateQualityScore(internal, external) {
    // Start with high score, deduct for issues
    let score = 100;
    
    // Deduct for too many external links relative to internal
    const ratio = external.total_links / (internal.total_links || 1);
    if (ratio > 0.2) score -= 5;
    if (ratio > 0.3) score -= 5;
    
    // Assume some broken links exist
    score -= 2; // Placeholder for actual broken link detection
    
    return Math.max(0, score);
}

function calculateDistributionScore(internal) {
    // Base on whether links are well distributed
    let score = 90;
    
    // Good if we have consistent article coverage
    if (internal.total_articles > 250) score += 5;
    
    return Math.min(100, score);
}

function updateInlinksTabContent(internal, external, stats) {
    // Update internal links tab
    const internalContent = document.getElementById('internal-content');
    if (internalContent && internal.total_links) {
        const cards = internalContent.querySelectorAll('.metric-card');
        
        if (cards[0]) {
            const value = cards[0].querySelector('.metric-value');
            if (value) value.textContent = internal.total_links.toLocaleString();
        }
    }
    
    // Update external links tab
    const externalContent = document.getElementById('external-content');
    if (externalContent && external.total_links) {
        const cards = externalContent.querySelectorAll('.metric-card');
        
        if (cards[0]) {
            const value = cards[0].querySelector('.metric-value');
            if (value) value.textContent = external.total_links.toLocaleString();
        }
        
        // Update social media card with real external link data
        if (cards[2] && stats.content?.media?.external) {
            const value = cards[2].querySelector('.metric-value');
            const subtitle = cards[2].querySelector('.metric-subtitle');
            if (value) value.textContent = stats.content.media.external.total_external_links.toLocaleString();
            if (subtitle) subtitle.textContent = 'Total external links';
        }
    }
}

function initializeTabSwitching() {
    // Remove any existing listeners and add new ones
    document.querySelectorAll('.tab').forEach(tab => {
        // Clone to remove existing listeners
        const newTab = tab.cloneNode(true);
        tab.parentNode.replaceChild(newTab, tab);
        
        newTab.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Get tab name from onclick or data attribute
            const onclickAttr = this.getAttribute('onclick');
            if (onclickAttr) {
                const match = onclickAttr.match(/showSummaryTab\('(.+?)'\)/);
                if (match) {
                    showSummaryTab(match[1], this);
                }
            }
        });
    });
}

function showSummaryTab(tabName, tabElement) {
    // Hide all content
    document.querySelectorAll('.summary-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Show selected content
    const selectedContent = document.getElementById(tabName + '-content');
    if (selectedContent) {
        selectedContent.classList.add('active');
    }
    
    // Update active tab
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    if (tabElement) {
        tabElement.classList.add('active');
    }
    
    // Update data for the selected tab if needed
    updateTabSpecificData(tabName);
}

function updateTabSpecificData(tabName) {
    // Refresh data specific to the selected tab
    const path = window.location.pathname;
    
    if (path.includes('api.html')) {
        if (tabName === 'performance') {
            updatePerformanceDistribution(dashboardDataCache['lighthouse-summary'] || {});
        } else if (tabName === 'vitals') {
            updateCoreVitalsMetrics(dashboardDataCache['dashboard-stats'] || {});
        }
    }
}

// Utility functions
function updateElement(id, value) {
    const element = document.getElementById(id);
    if (element) {
        element.textContent = value;
    }
}

function formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function showError(message) {
    const errorElement = document.getElementById('error');
    if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }
    console.error(message);
}


// Additional Dashboard Enhancements
// Add new tabs and functionality

function addPageSizeTab() {
    // Add Page Size tab to API dashboard
    const tabs = document.querySelector('.tabs');
    if (tabs && window.location.pathname.includes('api.html')) {
        // Check if not already added
        if (!document.getElementById('pagesize-tab')) {
            const newTab = document.createElement('button');
            newTab.className = 'tab';
            newTab.id = 'pagesize-tab';
            newTab.innerHTML = `
                Page Size
                <span class="tab-metric" id="pageSizeScore">89</span>
            `;
            newTab.onclick = function() { showSummaryTab('pagesize'); };
            tabs.appendChild(newTab);
        }
    }
}

function addBuildTab() {
    // Add Build Performance tab to Content dashboard
    const tabs = document.querySelector('.tabs');
    if (tabs && window.location.pathname.includes('index.html')) {
        if (!document.getElementById('build-tab')) {
            const newTab = document.createElement('button');
            newTab.className = 'tab';
            newTab.id = 'build-tab';
            newTab.innerHTML = `
                Build
                <span class="tab-metric" id="buildScore">97</span>
            `;
            newTab.onclick = function() { showSummaryTab('build'); };
            tabs.appendChild(newTab);
        }
    }
}

// Update the enhanced metrics
function updateEnhancedMetrics() {
    const stats = dashboardDataCache['dashboard-stats'] || {};
    
    // Update Page Size metrics
    if (stats.performance?.page_size) {
        updateElement('avgPageSize', formatBytes(stats.performance.page_size.average_total_size));
        updateElement('largestPage', stats.performance.page_size.largest_page.country);
        updateElement('largestPageSize', formatBytes(stats.performance.page_size.largest_page.size));
        updateElement('smallestPage', stats.performance.page_size.smallest_page.country);
        updateElement('smallestPageSize', formatBytes(stats.performance.page_size.smallest_page.size));
        
        // Calculate page size score
        const avgSize = stats.performance.page_size.average_total_size;
        let score = 100;
        if (avgSize > 500000) score -= 10; // Over 500KB
        if (avgSize > 750000) score -= 10; // Over 750KB
        if (avgSize > 1000000) score -= 10; // Over 1MB
        updateElement('pageSizeScore', Math.max(0, score));
    }
    
    // Update Build Performance metrics
    if (stats.technical?.build_system) {
        updateElement('avgBuildTime', stats.technical.build_system.average_build_time + 's');
        updateElement('totalBuildTime', stats.technical.build_system.total_build_time_minutes + 'min');
        updateElement('buildScripts', stats.technical.build_system.total_scripts);
        
        // Calculate build score based on speed
        const buildTime = stats.technical.build_system.average_build_time;
        let score = 100;
        if (buildTime > 1) score -= 5;
        if (buildTime > 2) score -= 10;
        updateElement('buildScore', Math.max(0, score));
    }
    
    // Update Load Times
    if (stats.technical?.optimization?.load_times) {
        const loadTimes = stats.technical.optimization.load_times;
        // These are already in the HTML, but could be made dynamic
        console.log('Load times available:', loadTimes);
    }
}

// Real-time updates indicator
function addLiveIndicator() {
    const h1Elements = document.querySelectorAll('h1');
    h1Elements.forEach(h1 => {
        if (!h1.querySelector('.live-indicator')) {
            const indicator = document.createElement('span');
            indicator.className = 'live-indicator';
            indicator.title = 'Real-time data';
            h1.appendChild(indicator);
        }
    });
}

// Export functionality removed - deprecated feature
// The exportDashboardData function has been removed along with the Export button

// Filter functionality for details table
function addTableFilter() {
    const table = document.getElementById('detailsTable');
    if (table && !document.getElementById('table-filter')) {
        const filterContainer = document.createElement('div');
        filterContainer.style.cssText = 'margin-bottom: 20px;';
        filterContainer.innerHTML = `
            <input type="text" id="table-filter" placeholder="Filter by country or demonym..." 
                   style="width: 100%; padding: 10px; border: 1px solid #e8ecf1; border-radius: 6px; font-size: 14px;">
        `;
        
        table.parentElement.insertBefore(filterContainer, table);
        
        document.getElementById('table-filter').addEventListener('keyup', function(e) {
            const filter = e.target.value.toLowerCase();
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    }
}

// Initialize enhancements
function initializeEnhancements() {
    addPageSizeTab();
    addBuildTab();
    updateEnhancedMetrics();
    addLiveIndicator();
    // Export button removed
    addTableFilter();
    
    // Add keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Export functionality removed
        
        // Number keys 1-5 for tab switching
        if (e.key >= '1' && e.key <= '5' && !e.ctrlKey && !e.metaKey) {
            const tabs = document.querySelectorAll('.tab');
            const index = parseInt(e.key) - 1;
            if (tabs[index]) {
                tabs[index].click();
            }
        }
    });
    
    // Auto-refresh data every 30 seconds
    setInterval(async function() {
        await loadDashboardData();
        updateAllMetrics();
        updateEnhancedMetrics();
        
        // Show refresh animation
        const indicator = document.querySelector('.live-indicator');
        if (indicator) {
            indicator.style.animation = 'none';
            setTimeout(() => {
                indicator.style.animation = 'pulse 2s infinite';
            }, 10);
        }
    }, 30000);
}

// Call enhancements after main initialization
if (typeof initializeDashboard !== 'undefined') {
    const originalInit = initializeDashboard;
    initializeDashboard = async function() {
        await originalInit();
        initializeEnhancements();
    };
}
  </script>
 </body>
</html>
