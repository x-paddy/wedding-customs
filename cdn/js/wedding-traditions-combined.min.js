const CONFIG={audioBasePath:"/wedding-customs/cdn/pronunciations/",enableLazyAudio:!0,enableSearch:!0,enableServiceWorker:!1,enablePerformanceMonitoring:!0,animationDuration:300,scrollOffset:50,debounceDelay:250,reviewAnimationInterval:4e3,audioPreloadMargin:"50px",audioErrorTimeout:3e3};window.matchMedia||(window.matchMedia=function(e){const t=e.match(/\(([^:]+):\s*([^)]+)\)/);t&&t[1],t&&t[2];return{matches:!1,media:e,onchange:null,addListener:function(e){console.warn("matchMedia.addListener is deprecated. Use addEventListener instead.")},removeListener:function(e){console.warn("matchMedia.removeListener is deprecated. Use removeEventListener instead.")},addEventListener:function(){},removeEventListener:function(){},dispatchEvent:function(){return!0}}});const FEATURES={localStorage:"localStorage"in window,intersectionObserver:"IntersectionObserver"in window,audioAPI:"Audio"in window,serviceWorker:"serviceWorker"in navigator},STATE={},utils={debounce:function(e,t){let i;return function(...n){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),e.apply(this,n)},t)}},throttle:function(e,t){let i;return function(){const n=arguments,s=this;i||(e.apply(s,n),i=!0,setTimeout(()=>i=!1,t))}},isElementInViewport:function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}};function initializeAccordions(){const e=document.querySelectorAll("h2.accordion");e.length&&e.forEach((e,t)=>{const i=e.nextElementSibling,n=`accordion-${t}`;function s(){const e=this.nextElementSibling,t=this.classList.contains("active"),i=document.querySelectorAll(".accordion-content"),n=document.querySelectorAll("h2.accordion");i.forEach(e=>{e.classList.remove("active")}),n.forEach(e=>{e.classList.remove("active"),e.setAttribute("title","Click to open"),e.setAttribute("aria-expanded","false")}),t||(this.classList.add("active"),this.setAttribute("title","Click to close"),this.setAttribute("aria-expanded","true"),e&&(e.classList.add("active"),setTimeout(()=>{this.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)))}setupAccordionState(e,i,n),e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.setAttribute("aria-controls",n),i.setAttribute("id",n),e.addEventListener("click",s),e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),s.call(this))})})}function setupAccordionState(e,t,i){t&&t.classList.contains("active")?(e.classList.add("active"),e.setAttribute("title","Click to close"),e.setAttribute("aria-expanded","true")):(e.setAttribute("title","Click to open"),e.setAttribute("aria-expanded","false"))}function handleHashNavigation(){const e=window.location.hash;if(!e)return;const t=document.querySelector(e);if(!t)return;const i=t.closest(".accordion-content");if(!i)return;const n=i.previousElementSibling;if(n&&n.classList.contains("accordion"))if(n.classList.contains("active"))t.scrollIntoView({behavior:"smooth",block:"center"});else{const e=document.querySelectorAll("h2.accordion"),s=document.querySelectorAll(".accordion-content");e.forEach(e=>{e.classList.remove("active"),e.setAttribute("aria-expanded","false")}),s.forEach(e=>{e.classList.remove("active")}),n.classList.add("active"),n.setAttribute("aria-expanded","true"),i.classList.add("active"),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"center"})},CONFIG.animationDuration)}}function initializeAudioTerms(){const e=document.querySelectorAll(".audio-term");e.length&&e.forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault(),await handleUnifiedPronunciation(e)}),e.addEventListener("keydown",async t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),await handleUnifiedPronunciation(e))})})}async function handleUnifiedPronunciation(e){if(e.classList.contains("playing"))return;const t=e.getAttribute("data-audio");if(t){e.classList.add("playing");try{const e=t.startsWith("http")?t:CONFIG.audioBasePath+t,i=new Audio(e);i.playbackRate=1,await i.play(),await new Promise(e=>{i.addEventListener("ended",e,{once:!0})})}catch(t){console.error("Audio playback error:",t);const i=e.querySelector(".phonetic");i&&(i.style.display="inline")}finally{e.classList.remove("playing")}}}function cleanupPronunciationElements(){document.querySelectorAll(".audio-term").forEach(e=>{const t=e.querySelector(".term-text")?.textContent||e.textContent.trim();if(e.title&&e.title.includes("traditional")&&e.title.includes("wedding term")){const i=e.getAttribute("data-definition")||"";e.title=i?`${t}: ${i}`:t}e.classList.remove("balloon-trigger","has-balloon")})}function preloadAudio(e){const t=e.getAttribute("data-audio");if(t&&FEATURES.audioAPI)try{let i;t.startsWith("http://")||t.startsWith("https://")?i=t:(i=CONFIG.audioBasePath+t,"file:"===window.location.protocol&&(i=i.replace(/^\/+/,"")));const n=new Audio(i);n.preload="metadata",n.addEventListener("error",()=>{console.warn("Failed to preload audio:",i)},{once:!0}),e.setAttribute("data-preloaded","true")}catch(e){console.warn("Error preloading audio for term:",e)}}function getTermDefinition(e,t){const i=t.getAttribute("data-definition");return i||""}function showTooltip(e,t,i=3e3){const n=document.querySelector(".error-tooltip");n&&n.remove();const s=document.createElement("div");s.className="error-tooltip",s.textContent=t,s.style.cssText="\n        position: absolute;\n        background: #333;\n        color: white;\n        padding: 8px 12px;\n        border-radius: 4px;\n        font-size: 12px;\n        z-index: 1000;\n        white-space: pre-line;\n        max-width: 200px;\n        text-align: center;\n        pointer-events: none;\n        opacity: 0;\n        transition: opacity 0.3s ease;\n    ",document.body.appendChild(s);const o=e.getBoundingClientRect();s.style.left=o.left+o.width/2-s.offsetWidth/2+"px",s.style.top=o.top-s.offsetHeight-8+"px",requestAnimationFrame(()=>{s.style.opacity="1"}),setTimeout(()=>{s.parentNode&&(s.style.opacity="0",setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300))},i)}function initializeBalloonTooltips(){const e=document.querySelectorAll(".audio-term");let t=null;e.forEach(i=>{const n=i.querySelector(".audio-phonetic");if(n){const e=n.textContent;i.setAttribute("data-phonetic",e)}const s=i.querySelector(".term-text");let o;if(s)o=s.textContent.trim();else{const e=i.cloneNode(!0),t=e.querySelector(".audio-phonetic");t&&t.remove(),o=e.textContent.replace(/\s+/g," ").trim()}let a=i.getAttribute("data-definition")||getTermDefinition(o,i);const r=o.replace(/ /g," "),c=i.querySelector(".phonetic");if(c&&c.textContent){const e=c.textContent;i.setAttribute("data-display-text",`${r}\n${e}\n"${a}"`)}else i.setAttribute("data-display-text",`${r}:\n${a}`);i.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation(),i.classList.add("show-pronunciation"),i.classList.contains("show-tooltip")||(e.forEach(e=>{e!==i&&(e.classList.remove("show-tooltip","show-pronunciation"),e.classList.add("bounce-out"),setTimeout(()=>{e.classList.remove("bounce-out")},400))}),i.classList.add("show-tooltip"),i.classList.remove("bounce-out"),t=i);if(i.getAttribute("data-audio")){const e=new CustomEvent("playAudio",{detail:{term:i}});i.dispatchEvent(e)}}),window.innerWidth>768&&(i.addEventListener("mouseenter",function(){i.classList.contains("show-pronunciation")}),i.addEventListener("mouseleave",function(){i.classList.contains("playing")||(i.classList.add("bounce-out"),setTimeout(()=>{i.classList.remove("bounce-out")},400))}))}),document.addEventListener("ended",function(e){e.target&&"AUDIO"===e.target.tagName&&t&&(t.classList.add("bounce-out"),setTimeout(()=>{t.classList.remove("show-tooltip","show-pronunciation","bounce-out"),t=null},400))},!0),document.addEventListener("pause",function(e){e.target&&"AUDIO"===e.target.tagName&&t&&!e.target.ended&&(t.classList.add("bounce-out"),setTimeout(()=>{t.classList.remove("show-tooltip","show-pronunciation","bounce-out"),t=null},400))},!0),document.addEventListener("click",function(i){i.target.closest(".audio-term")||(e.forEach(e=>{e.classList.contains("show-tooltip")&&(e.classList.add("bounce-out"),setTimeout(()=>{e.classList.remove("show-tooltip","show-pronunciation","bounce-out")},400))}),t=null)})}function initializeMobileMenu(){const e=document.querySelector(".nav-hamburger"),t=document.querySelector(".nav-links");e&&t&&(e.setAttribute("aria-expanded","false"),e.setAttribute("aria-controls","nav-links"),e.setAttribute("aria-label","Toggle navigation menu"),e.addEventListener("click",function(){t.classList.toggle("active");const i=t.classList.contains("active");e.setAttribute("aria-expanded",i)}),document.addEventListener("click",function(i){e.contains(i.target)||t.contains(i.target)||(t.classList.remove("active"),e.setAttribute("aria-expanded","false"))}),document.addEventListener("keydown",function(i){"Escape"===i.key&&t.classList.contains("active")&&(t.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.focus())}),e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())}))}function styleEmojiCallouts(){const e=["💍","📍","💰","🎯","🎵","🕐","👥","💡","📸","🎭","🍾","🌟","💝","🎊","🏛️","⛪","🍷","🥂","🎂","💐","🎁","❤️","💒","👰","🤵","📅","📋","💎","🎪","🎨","🎯","🔔","⚠️","🚨","⚡","💵","💸","ℹ️","📌","🎉"],t=["Budget Alert","Guest Count","Cost Comparison","The Vibe","Real Wedding Story","Pro Tip","Important Note","Quick Tip","Fun Fact","Did You Know","Planning Tip","Tradition Alert","Critical Warning","Survival Tip","Time Management","Professional Support","Destination Magic","Two-Day Approach","Photo Opportunity","Double Reception","International Guests"],i=["style-postit","style-torn","style-bubble","style-notebook","style-vintage","style-alert"];let n=0;document.querySelectorAll(".accordion-content p").forEach(s=>{const o=s.firstElementChild,a=s.textContent.trim();let r=!1,c=null;for(const t of e)if(a.startsWith(t)){r=!0,c=t;break}if(o&&"STRONG"===o.tagName){const e=o.textContent;for(const i of t)if(e.includes(i)){r=!0;break}}r&&!s.classList.contains("emoji-callout")&&(s.classList.add("emoji-callout"),c?["⚠️","🚨","⚡"].includes(c)?s.classList.add("style-alert"):["💰","💵","💸"].includes(c)?s.classList.add("style-vintage"):["💡","ℹ️","📌"].includes(c)?s.classList.add("style-bubble"):["🎵","🎉","🎊"].includes(c)?s.classList.add("style-torn"):(s.classList.add(i[n%i.length]),n++):(s.classList.add(i[n%i.length]),n++))})}function initializeCurrencyTooltips(){const e=document.querySelectorAll(".currency");e.forEach(t=>{t.hasAttribute("tabindex")||t.setAttribute("tabindex","0"),t.hasAttribute("role")||t.setAttribute("role","text"),t.addEventListener("click",function(t){t.stopPropagation(),e.forEach(e=>{e!==this&&e.classList.remove("show-conversion")}),this.classList.toggle("show-conversion")}),t.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())})}),document.addEventListener("click",function(t){t.target.closest(".currency")||e.forEach(e=>{e.classList.remove("show-conversion")})})}function initializeMutationObserver(){if("MutationObserver"in window)try{new MutationObserver(utils.throttle(function(e){let t=!1;if(e.forEach(function(e){e.addedNodes.length>0&&Array.from(e.addedNodes).forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.matches(".accordion-content, .audio-term, .currency")||e.querySelector(".accordion-content, .audio-term, .currency"))&&(t=!0)})}),t){styleEmojiCallouts(),initializeCurrencyTooltips();const e=document.querySelectorAll(".audio-term:not([data-initialized])");e.length>0&&(console.log("Initializing",e.length,"new audio terms"),e.forEach(e=>e.setAttribute("data-initialized","true")))}},250)).observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1}),console.log("Mutation observer initialized for dynamic content")}catch(e){console.warn("Failed to initialize mutation observer:",e)}}function getReviewerInitials(e){const t=e.trim().split(" ");return t.length>=2?(t[0][0]+t[t.length-1][0]).toUpperCase():t.length>0?t[0].substring(0,2).toUpperCase():"RV"}function getAvatarColor(e){return"#6c757d"}function createDetailedReviewCard(e,t){getReviewerInitials(e.reviewer_name),getAvatarColor(e.reviewer_name);const i="★".repeat(Math.floor(e.rating||5)),n=e.review_text_highlighted||e.review_text,s=e.reviewer_name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),o=[];e.is_local_guide&&o.push('<span class="local-guide-badge">Local Guide</span>'),e.is_verified&&o.push('<span class="verified-badge">Verified</span>');const a=[];e.photo_count>0&&a.push(`<span class="review-photos"><svg class="photo-icon" viewBox="0 0 24 24" width="18" height="18"><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86l-3 3.87L9 13.14 6 17h12l-3.86-5.14z"/></svg> ${e.photo_count} photos</span>`),e.helpful_count>0&&a.push(`<span class="review-helpful"><svg class="helpful-icon" viewBox="0 0 24 24" width="18" height="18"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/></svg> ${e.helpful_count} helpful</span>`);return`<div class="${0===t?"review-card-wrapper active":"review-card-wrapper offscreen-right"}">\n        <div class="review-card-modern">\n            <div class="review-header">\n                <div class="reviewer-avatar" data-reviewer="${s}"></div>\n                <div class="reviewer-info">\n                    <div class="reviewer-name">\n                        ${e.reviewer_name}\n                        ${o.join("")}\n                    </div>\n                    <div class="review-stars">${i}</div>\n                </div>\n                <div class="google-maps-icon" data-reviewer="google-maps" title="Google Maps review"></div>\n            </div>\n            <p class="review-text">\n                ${n}\n            </p>\n            <div class="review-footer">\n                <span class="review-date">${e.review_date||""}</span>\n                <div class="review-actions">\n                    ${a.join("")}\n                </div>\n            </div>\n        </div>\n    </div>`}async function initializeReviewCards(){const e=document.getElementById("customer-review");if(!e)return;const t=e.querySelector(".review-carousel");if(!t)return;const i=t.dataset.reviewsSource||"/wedding-customs/cdn/json/reviews.min.json";try{const n=await fetch(i);if(!n.ok)throw new Error(`Failed to load reviews: ${n.status}`);const s=(await n.json()).reviews||[];s.slice(0,6).forEach((e,i)=>{const n=createDetailedReviewCard(e,i);t.insertAdjacentHTML("beforeend",n)}),t.reviewDelays=s.slice(0,6).map(e=>e.rotation_delay||5e3),e.classList.remove("hidden"),e.style.display="block",initializeReviewCarousel(t)}catch(e){console.error("Failed to load reviews:",e)}}function initializeReviewCarousel(e){const t=e.querySelector(".review-nav-button.prev"),i=e.querySelector(".review-nav-button.next"),n=e.querySelectorAll(".review-card-wrapper");if(0===n.length)return;let s=0,o=!1;const a=n.length;function r(e){if(o||e===s)return;o=!0,n.forEach(e=>{e.classList.remove("active","offscreen-left","offscreen-right")});n.forEach((t,i)=>{i===e?t.classList.add("active"):i<e?t.classList.add("offscreen-left"):t.classList.add("offscreen-right")}),s=e,setTimeout(()=>{o=!1},600)}function c(){r((s+1)%a)}function l(){r((s-1+a)%a)}t&&t.addEventListener("click",l),i&&i.addEventListener("click",c),e.addEventListener("keydown",e=>{"ArrowLeft"===e.key?l():"ArrowRight"===e.key&&c()});let d,u=0,v=0;e.addEventListener("touchstart",e=>{u=e.changedTouches[0].screenX}),e.addEventListener("touchend",e=>{v=e.changedTouches[0].screenX,function(){const e=50,t=u-v;Math.abs(t)>e&&(t>0?c():l())}()});let h=!1;function p(){if(!h){const t=e.reviewDelays&&e.reviewDelays[s]?e.reviewDelays[s]:5e3;d=setTimeout(()=>{h||(c(),p())},t)}}function f(){d||h||p()}function m(){d&&(clearTimeout(d),d=null)}e.addEventListener("mouseenter",()=>{h=!0,m()}),e.addEventListener("mouseleave",()=>{h=!1,f()}),t&&(t.removeEventListener("click",l),t.addEventListener("click",()=>{m(),l(),setTimeout(()=>{h||p()},5e3)})),i&&(i.removeEventListener("click",c),i.addEventListener("click",()=>{m(),c(),setTimeout(()=>{h||p()},5e3)})),r(0),f()}function setupReviewCardsRotation(){const e=document.getElementById("reviewTrack");if(!e)return;const t=e.querySelectorAll(".review-card-modern");if(0===t.length)return;let i,n=0,s=!1;function o(e,i="next"){const s=n,o=t[s],r=t[e];s!==e&&(t.forEach(e=>{e.classList.remove("exiting-left","exiting-right","entering-left","entering-right")}),"next"===i?(o.classList.add("exiting-left"),r.classList.add("entering-right")):(o.classList.add("exiting-right"),r.classList.add("entering-left")),setTimeout(()=>{o.classList.remove("active"),r.classList.add("active"),setTimeout(()=>{o.classList.remove("exiting-left","exiting-right"),r.classList.remove("entering-left","entering-right")},50)},50),a())}function a(){const e=document.querySelector(".review-nav-button.prev"),t=document.querySelector(".review-nav-button.next");e&&(e.disabled=!1,e.classList.remove("disabled")),t&&(t.disabled=!1,t.classList.remove("disabled"))}function r(){!s&&n<t.length-1?(n++,o(n,"next")):s||n!==t.length-1||(n=0,o(n,"next"))}function c(){i||s||(i=setInterval(r,4e3))}function l(){i&&(clearInterval(i),i=null)}t[0].classList.add("active"),t.forEach((e,t)=>{0!==t&&e.classList.remove("active")});const d=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting?c():l()})},{threshold:.5}),u=e.closest(".wedding-review");u&&d.observe(u),e.addEventListener("mouseenter",()=>{s=!0,l()}),e.addEventListener("mouseleave",()=>{s=!1;const t=e.closest(".wedding-review");if(t){const e=t.getBoundingClientRect();e.top<window.innerHeight&&e.bottom>0&&c()}});const v=document.querySelector(".review-nav-button.prev"),h=document.querySelector(".review-nav-button.next");v&&v.addEventListener("click",()=>{l(),n>0?(n--,o(n,"prev")):(n=t.length-1,o(n,"prev")),setTimeout(c,5e3)}),h&&h.addEventListener("click",()=>{l(),r(),setTimeout(c,5e3)}),a()}function initializeDiscover3Carousel(){const e=document.querySelector(".discover-3");if(!e)return;const t=e.querySelector(".traditions-grid");if(!t)return;const i=Array.from(t.querySelectorAll(".tradition-panel"));if(0===i.length)return;const n=document.createElement("div");n.className="discover-carousel-wrapper";const s=document.createElement("div");s.className="discover-carousel-track",i.forEach(e=>{e.classList.add("discover-carousel-item"),s.appendChild(e)}),n.appendChild(s),t.parentNode.replaceChild(n,t);n.insertAdjacentHTML("beforeend",'\n        <button class="discover-nav-button prev" aria-label="Previous articles">\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <path d="M15 18l-6-6 6-6"></path>\n            </svg>\n        </button>\n        <button class="discover-nav-button next" aria-label="Next articles">\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <path d="M9 18l6-6-6-6"></path>\n            </svg>\n        </button>\n    ');let o=0;const a=i.length,r=Math.max(0,a-4),c=n.querySelector(".discover-nav-button.prev"),l=n.querySelector(".discover-nav-button.next");function d(){const e=-290*o;s.style.transform=`translateX(${e}px)`,c.disabled=0===o,l.disabled=o>=r,i.forEach((e,t)=>{const i=t>=o&&t<o+4;e.setAttribute("aria-hidden",!i)})}function u(){o>0&&(o=Math.max(0,o-4),d())}function v(){o<r&&(o=Math.min(r,o+4),d())}c.addEventListener("click",u),l.addEventListener("click",v),n.addEventListener("keydown",e=>{"ArrowLeft"===e.key?u():"ArrowRight"===e.key&&v()});let h,p=0,f=0;function m(){const e=window.innerWidth;let t=4;e<=768?t=1:e<=1024?t=2:e<=1280&&(t=3),4!==t&&(o=Math.min(o,Math.max(0,a-t)),d())}n.addEventListener("touchstart",e=>{p=e.changedTouches[0].screenX}),n.addEventListener("touchend",e=>{f=e.changedTouches[0].screenX,function(){const e=50,t=p-f;Math.abs(t)>e&&(t>0?v():u())}()}),d(),window.addEventListener("resize",()=>{clearTimeout(h),h=setTimeout(m,150)})}document.addEventListener("DOMContentLoaded",function(){try{initializeAccordions(),initializeBalloonTooltips(),initializeAudioTerms(),initializeMobileMenu(),initializeCurrencyTooltips(),initializeReviewCards(),"function"==typeof initializeDiscover3Carousel&&initializeDiscover3Carousel(),initializeMutationObserver(),setTimeout(styleEmojiCallouts,150),handleHashNavigation(),window.addEventListener("hashchange",handleHashNavigation),window.addEventListener("error",function(e){console.warn("Wedding Traditions JS Error:",e.error)})}catch(e){console.error("Failed to initialize Wedding Traditions JavaScript:",e)}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",cleanupPronunciationElements):cleanupPronunciationElements(),setTimeout(cleanupPronunciationElements,1e3),"onLine"in navigator&&(window.addEventListener("online",()=>{console.log("Connection restored"),document.body.classList.remove("offline")}),window.addEventListener("offline",()=>{console.log("Connection lost"),document.body.classList.add("offline")})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeDiscover3Carousel):initializeDiscover3Carousel();class ReviewCarousel{constructor(e){this.container=e,this.carousel=e.querySelector(".review-carousel"),this.cards=[],this.currentIndex=0,this.autoPlayInterval=null,this.isVisible=!1,this.isPaused=!1,this.AUTOPLAY_DELAY=3e3,this.init()}async init(){const e=this.carousel.getAttribute("data-reviews-source");e&&await this.loadReviewsFromJSON(e);let t=this.container.querySelectorAll(".review-card-wrapper");if(t.length>0)this.cards=Array.from(t);else{const e=this.container.querySelectorAll(".review-card-modern");e.forEach((e,t)=>{const i=document.createElement("div");i.className="review-card-wrapper",i.appendChild(e.cloneNode(!0)),0===t?i.classList.add("active"):i.classList.add("offscreen-right"),this.carousel.appendChild(i),this.cards.push(i)}),e.forEach(e=>e.remove())}0!==this.cards.length?(this.setupNavigation(),this.setupHoverPause(),this.setupIntersectionObserver(),this.container.classList.remove("hidden"),this.container.style.display=""):console.warn("No review cards found")}async loadReviewsFromJSON(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=(await t.json()).reviews||[];this.carousel.innerHTML="",this.carousel.innerHTML='\n        <button class="review-nav-button prev" aria-label="Previous review" type="button">\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">\n            <polyline points="15 18 9 12 15 6"></polyline>\n          </svg>\n        </button>\n        <button class="review-nav-button next" aria-label="Next review" type="button">\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">\n            <polyline points="9 18 15 12 9 6"></polyline>\n          </svg>\n        </button>\n      ',i.forEach((e,t)=>{const i=this.createReviewCard(e),n=document.createElement("div");n.className="review-card-wrapper",n.innerHTML=i,0===t?n.classList.add("active"):n.classList.add("offscreen-right"),this.carousel.appendChild(n),this.cards.push(n)})}catch(e){console.error("Error loading reviews:",e)}}createReviewCard(e){const t=this.escapeHtml(e.reviewer_name||"Customer"),i=this.escapeHtml(e.review_title||""),n=e.review_text_highlighted||e.review_text||"",s=parseFloat(e.rating||5),o=this.escapeHtml(e.review_date||e.relative_date||e.date||""),a=e.is_local_guide||!1,r=e.is_verified||!1,c=e.photo_count||0,l=e.helpful_count||0,d=this.getReviewerInitials(t),u="★".repeat(Math.floor(s));let v="";a&&(v+='<span class="local-guide-badge">Local Guide</span>'),r&&(v+='<span class="verified-badge">Verified</span>');let h=[];return c>0&&h.push(`${c} photos`),l>0&&h.push(`${l} helpful`),`\n      <div class="review-card-modern">\n        <div class="review-header">\n          <div class="reviewer-avatar default">\n            <span>${d}</span>\n          </div>\n          <div class="reviewer-info">\n            <div class="reviewer-name">\n              ${t}\n              ${v}\n            </div>\n            <div class="review-stars">${u}</div>\n          </div>\n          <div class="google-maps-icon" aria-label="Google Maps review"></div>\n        </div>\n\n        ${i?`<h3 class="review-title">${i}</h3>`:""}\n\n        <p class="review-text">\n          ${n}\n        </p>\n\n        <div class="review-footer">\n          <span class="review-date">${o}</span>\n          ${h.length>0?`<span class="review-metadata">${h.join(" • ")}</span>`:""}\n        </div>\n      </div>\n    `}getReviewerInitials(e){const t=e.trim().split(" ");return t.length>=2?(t[0][0]+t[t.length-1][0]).toUpperCase():t.length>0?t[0].substring(0,2).toUpperCase():"RV"}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}setupNavigation(){const e=this.container.querySelector(".review-nav-button.prev"),t=this.container.querySelector(".review-nav-button.next");e&&e.addEventListener("click",()=>this.navigate("prev")),t&&t.addEventListener("click",()=>this.navigate("next"))}setupHoverPause(){this.cards.forEach(e=>{e.addEventListener("mouseenter",()=>{this.isPaused=!0,this.stopAutoPlay()}),e.addEventListener("mouseleave",()=>{this.isPaused=!1,this.isVisible&&this.startAutoPlay()})})}setupIntersectionObserver(){new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting?(this.isVisible=!0,this.isPaused||this.startAutoPlay()):(this.isVisible=!1,this.stopAutoPlay())})},{root:null,threshold:.5}).observe(this.container)}setupIndicators(){const e=document.createElement("div");e.className="review-indicators",this.cards.forEach((t,i)=>{const n=document.createElement("button");n.className="review-dot",n.setAttribute("aria-label",`Go to review ${i+1}`),0===i&&n.classList.add("active"),n.addEventListener("click",()=>this.goToSlide(i)),e.appendChild(n)}),this.container.appendChild(e),this.indicators=e.querySelectorAll(".review-dot")}navigate(e){this.stopAutoPlay(),"next"===e?this.showNext():this.showPrev(),this.isVisible&&!this.isPaused&&this.startAutoPlay()}showNext(){this.cards[this.currentIndex].classList.remove("active"),this.cards[this.currentIndex].classList.add("offscreen-right"),this.currentIndex=(this.currentIndex+1)%this.cards.length;const e=this.cards[this.currentIndex];e.classList.add("no-transition"),e.classList.remove("offscreen-right"),e.classList.add("offscreen-left"),e.classList.remove("active"),e.offsetWidth,e.classList.remove("no-transition"),setTimeout(()=>{e.classList.remove("offscreen-left"),e.classList.add("active")},100)}showPrev(){this.cards[this.currentIndex].classList.remove("active"),this.cards[this.currentIndex].classList.add("offscreen-left"),this.currentIndex=(this.currentIndex-1+this.cards.length)%this.cards.length,this.cards[this.currentIndex].classList.remove("offscreen-left"),this.cards[this.currentIndex].classList.remove("offscreen-right"),this.cards[this.currentIndex].classList.add("active")}goToSlide(e){e!==this.currentIndex&&(this.stopAutoPlay(),this.cards[this.currentIndex].classList.remove("active"),e>this.currentIndex?this.cards[this.currentIndex].classList.add("offscreen-left"):this.cards[this.currentIndex].classList.add("offscreen-right"),this.currentIndex=e,this.cards[this.currentIndex].classList.remove("offscreen-left"),this.cards[this.currentIndex].classList.remove("offscreen-right"),this.cards[this.currentIndex].classList.add("active"),this.isVisible&&!this.isPaused&&this.startAutoPlay())}updateIndicators(){this.indicators.forEach((e,t)=>{t===this.currentIndex?e.classList.add("active"):e.classList.remove("active")})}startAutoPlay(){this.autoPlayInterval||(this.autoPlayInterval=setInterval(()=>{this.showNext()},this.AUTOPLAY_DELAY))}stopAutoPlay(){this.autoPlayInterval&&(clearInterval(this.autoPlayInterval),this.autoPlayInterval=null)}}function initReviewCarousel(){const e=document.querySelector(".wedding-review");e&&e.querySelector(".review-carousel")&&new ReviewCarousel(e)}document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".wedding-review");e&&e.querySelector(".review-carousel")&&new ReviewCarousel(e)}),"undefined"!=typeof module&&module.exports&&(module.exports={ReviewCarousel:ReviewCarousel,initReviewCarousel:initReviewCarousel});